---
import Typewriter from './Typewriter.astro';
import type { ImageMetadata } from 'astro';
import { heroConfig } from '../config';

interface Props {
    text: string;
    subtitle?: string;
    backgroundImage?: string | ImageMetadata;
    compact?: boolean;
    interactive?: boolean; // 是否启用悬停交互效果（仅主页）
}

const { 
    text, 
    subtitle, 
    backgroundImage = heroConfig.postDefaultBackground,
    compact = false,
    interactive = false
} = Astro.props;
const backgroundImageSrc =
    typeof backgroundImage === 'string' ? backgroundImage : backgroundImage.src;

let heroClass = compact ? 'hero-header hero-compact' : 'hero-header';
if (interactive) heroClass += ' hero-interactive';
---

<div class={heroClass} transition:name="hero">
    <div class="hero-bg" style={`background-image: url('${backgroundImageSrc}')`}></div>
    <div class="hero-overlay"></div>
    <div class="hero-content">
        <Typewriter text={text} tag="h1" class="hero-title" />
        {subtitle && <p class="hero-subtitle">{subtitle}</p>}
        <slot />
    </div>
    {!compact && (
        <div class="scroll-down">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M7 13l5 5 5-5M7 6l5 5 5-5"/>
            </svg>
        </div>
    )}
</div>

<style>
    .hero-header {
        position: relative;
        width: 100%;
        height: 100vh;
        height: 100dvh;
        min-height: 520px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        overflow: hidden; /* Ensure background doesn't overflow */
    }

    /* New background element for zoom effect */
    .hero-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-position: center;
        background-size: cover;
        background-repeat: no-repeat;
        z-index: 0;
        transition: transform 10s ease-out; /* Slow initial movement if needed, or just prepare for hover */
        transition: transform 0.8s var(--ease-out-expo);
    }

    .hero-header.hero-compact {
        height: 60vh;
        height: 60dvh;
        min-height: 360px;
        margin-bottom: -88px;
    }
    
    .hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        z-index: 1; /* Above bg, below content */
        transition: opacity 0.8s var(--ease-out-expo);
    }

    .hero-content {
        position: relative;
        z-index: 10;
        text-align: center;
        padding: 2em; /* Increase padding area slightly for easier targeting */
        cursor: default; /* Indicate this area is special */
    }
    
    .hero-title {
        font-size: clamp(2rem, 4.5vw, 2.5rem);
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(255, 255, 255, 0.3);
        line-height: 1.4;
        color: white;
    }

    .hero-subtitle {
        font-size: 1.2em;
        opacity: 0; /* Start hidden */
        margin-top: 0.5em;
        color: white;
        animation: fade-in-up 1s ease-out forwards;
        animation-delay: 2.5s; /* Wait for typewriter to mostly finish */
    }

    @keyframes fade-in-up {
        0% { opacity: 0; transform: translateY(20px); }
        100% { opacity: 0.9; transform: translateY(0); }
    }

    /* Bouncing Arrow */
    .scroll-down {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        color: white;
        animation: bounce 2s infinite;
        cursor: pointer;
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
            transform: translateX(-50%) translateY(0);
        }
        40% {
            transform: translateX(-50%) translateY(-10px);
        }
        60% {
            transform: translateX(-50%) translateY(-5px);
        }
    }

    @media (hover: hover) and (pointer: fine) {
        /* 仅在 .hero-interactive 类存在且为桌面指针时启用悬停效果 */
        .hero-header.hero-interactive:has(.hero-content:hover) .hero-bg {
            transform: scale(1.05);
        }

        .hero-header.hero-interactive:has(.hero-content:hover) .hero-overlay {
            opacity: 0.1;
        }
    }
    
    @media (max-width: 720px) {
        .hero-header {
            min-height: 460px;
        }

        .hero-header.hero-compact {
            height: 52vh;
            height: 52dvh;
            min-height: 260px;
            margin-bottom: -56px;
        }

        .hero-content {
            padding: 1.25em;
        }

        .hero-title {
            font-size: clamp(1.3rem, 6vw, 1.75rem);
            line-height: 1.35;
        }

        .hero-subtitle {
            font-size: 1rem;
        }
    }
</style>
