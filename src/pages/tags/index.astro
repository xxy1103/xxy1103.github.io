---
import ContentCard from '../../components/ContentCard.astro';
import HeroHeader from '../../components/HeroHeader.astro';
import PageShell from '../../layouts/PageShell.astro';
import SectionHeader from '../../components/SectionHeader.astro';
import { heroConfig, siteTitle } from '../../config';
import { getTagStats } from '../../lib/content/blog';

const sortedTags = await getTagStats();
const tagsHero = heroConfig.tags;
---

<PageShell
  title={`标签 | ${siteTitle}`}
  description="按标签浏览所有博客文章"
  transparentHeader={true}
  pageId="tags-index"
>
  <Fragment slot="head">
    <style>
      .stats-wrapper {
        position: relative;
        min-height: 50vh;
        background-color: var(--color-bg);
        transform: translateY(88px);
      }

      .posts-container {
        background: var(--color-surface);
        border-radius: 16px;
        box-shadow: 
          0 16px 64px rgba(0, 0, 0, 0.18),
          0 8px 24px rgba(0, 0, 0, 0.12),
          0 0 0 1px var(--color-border-subtle);
        padding: 2em;
        min-height: 300px;
        transform: translateY(-88px);
      }

      .posts-container :global(.section-header) {
        display: flex;
        align-items: baseline;
        gap: 0.5em;
        margin-bottom: 0.5em;
      }

      .posts-container :global(.section-number) {
        font-size: 0.9em;
        color: var(--color-text-muted);
        font-weight: 500;
      }

      .posts-container :global(.section-title) {
        font-size: 1.8em;
        font-weight: bold;
        margin: 0;
        color: var(--color-text);
      }

      .posts-container :global(.intro-text) {
        color: var(--color-text-secondary);
        margin-bottom: 2em;
        font-size: 0.9em;
        line-height: 1.6;
      }

      .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        padding-top: 1em;
      }

      .tag {
        display: inline-flex;
        align-items: center;
        padding: 0.8em 1.5em;
        background: var(--color-surface-hover);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid var(--color-border);
        box-shadow:
          0 4px 6px rgba(var(--shadow-color), 0.02),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        color: var(--color-text-secondary);
        border-radius: 50px;
        text-decoration: none;
        transition:
          color 0.4s cubic-bezier(0.25, 0.8, 0.25, 1),
          background-color 0.4s cubic-bezier(0.25, 0.8, 0.25, 1),
          border-color 0.4s cubic-bezier(0.25, 0.8, 0.25, 1),
          box-shadow 0.4s cubic-bezier(0.25, 0.8, 0.25, 1),
          transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        font-weight: 500;
        position: relative;
        overflow: hidden;
        opacity: 0;
        animation: fadeInUp 0.7s cubic-bezier(0.2, 0.9, 0.3, 1) forwards;
        animation-delay: calc(var(--i) * 0.04s);
      }

      .tag::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 50%;
        background: linear-gradient(to bottom, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0));
        border-radius: 50px 50px 0 0;
        opacity: 0.3;
        pointer-events: none;
      }

      .tag::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, var(--accent), #a1c4fd);
        opacity: 0;
        transition: opacity 0.4s ease;
        z-index: -1;
      }

      .tag:hover {
        border-color: rgba(255, 255, 255, 0.4);
        color: white;
        transform: translateY(-3px) scale(1.02);
        box-shadow:
          0 15px 25px -10px rgba(var(--accent-rgb, 0, 0, 0), 0.3),
          inset 0 1px 0 rgba(255, 255, 255, 0.4);
      }

      .tag:hover::after {
        opacity: 1;
      }

      .tag-text,
      .tag-count {
        position: relative;
        z-index: 2;
        text-shadow: none;
        transition: color 0.3s;
      }

      .tag-count {
        margin-left: 0.8em;
        font-size: 0.75em;
        opacity: 0.8;
        font-weight: 600;
        background: rgba(var(--shadow-color), 0.06);
        padding: 3px 9px;
        border-radius: 20px;
        box-shadow: inset 0 1px 2px rgba(var(--shadow-color), 0.05);
      }

      .tag:hover .tag-count {
        background: rgba(255, 255, 255, 0.25);
        color: white;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .no-tags {
        color: rgb(var(--gray));
        font-style: italic;
        text-align: center;
        padding: 2em;
      }

      @media (max-width: 900px) {
        .posts-container {
          padding: 1.4em;
        }

        .tags-container {
          gap: 0.75rem;
        }
      }

      @media (max-width: 720px) {
        .posts-container {
          padding: 1.1em;
          border-radius: 0;
        }

        .posts-container :global(.section-title) {
          font-size: clamp(1.45rem, 6vw, 1.7rem);
        }

        .tag {
          padding: 0.7em 1.2em;
        }
      }
    </style>
  </Fragment>

  <HeroHeader
    text={tagsHero.text}
    subtitle={tagsHero.subtitle}
    backgroundImage={tagsHero.backgroundImage}
    compact={true}
  />

  <div class="stats-wrapper">
    <ContentCard id="stats-card">
      <div class="posts-container">
        <SectionHeader number="Tags" title="所有标签" intro={`共包含 ${sortedTags.length} 个标签`} />

        {sortedTags.length > 0 ? (
          <div class="tags-container">
            {sortedTags.map(([tag, count], index) => (
              <a href={`/tags/${encodeURIComponent(tag)}/`} class="tag" style={`--i: ${index}`}>
                <span class="tag-text"># {tag}</span>
                <span class="tag-count">{count}</span>
              </a>
            ))}
          </div>
        ) : (
          <p class="no-tags">暂无标签</p>
        )}
      </div>
    </ContentCard>
  </div>

</PageShell>
