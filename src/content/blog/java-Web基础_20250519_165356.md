---
title: java-WebåŸºç¡€ä¹‹Servletã€Filterã€Listener
date: 2025-05-19 16:53:56
categories: ç¬”è®°
tags: ['java']
---
åŠªåŠ›æœ‰æ—¶å€™ä¹Ÿæˆ˜èƒœä¸äº†å¤©åˆ†ï¼Œä½†è‡³å°‘èƒ½è®©åˆ«äººçœ‹å¾—èµ·ä½ ã€‚

â€”â€”ã€Šä¸ƒé¾™ç ã€‹

<!-- more -->

# æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªMavené¡¹ç›®

ç”±äºè¦å­¦ä¹ Javaä¸­çš„Servletï¼ŒFilterï¼ŒListenerç­‰ç»„ä»¶éœ€è¦ä¸‹è½½ä¾èµ–ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ„å»ºå·¥å…·ä¸­è¿›è¡Œæ¼”ç¤ºå’Œå­¦ä¹ ã€‚æœ¬æ–‡ä½¿ç”¨Mavené¡¹ç›®ä½œä¸ºç¤ºä¾‹ã€‚

## åˆ›å»ºæ–‡ä»¶å¤¹ç»“æ„

```java
mkdir -p myapp/src/main/java	//åˆ›å»ºæ–‡ä»¶ç»“æ„
cd myapp		//è¿›å…¥é¡¹ç›®
```

## æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ `pom.xml`

```xml
<!-- æ–‡ä»¶: pom.xml -->
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.example</groupId>
    <artifactId>myapp</artifactId>
    <version>1.0-SNAPSHOT</version>
</project>

```

è¿™æ ·æˆ‘ä»¬å°±åˆ›å»ºå¥½äº†ä¸€ä¸ªæœ€ç®€å•mavené¡¹ç›®ã€‚

# Servlet

Servlet æ˜¯JavaWebæŠ€æœ¯çš„æ ¸å¿ƒç»„ä»¶ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å°ç¨‹åºï¼Œç”¨äºå¤„ç†å®¢æˆ·ç«¯(å¦‚æµè§ˆå™¨)çš„è¯·æ±‚ï¼Œç”ŸæˆåŠ¨æ€å“åº”ã€‚Servletä¸»è¦ç”¨äºå¤„ç†Httpè¯·æ±‚ï¼Œå®ç°åŠ¨æ€ç½‘é¡µå†…å®¹ç”Ÿæˆã€‚

## Servlet ç”Ÿå‘½å‘¨æœŸ

Servletçš„ç”Ÿå‘½å‘¨æœŸç”±Servletå®¹å™¨(å¦‚Tomcat)ç®¡ç†ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š

> Servletå®¹å™¨ï¼šWebæœåŠ¡å™¨ï¼Œç”¨äºæ¥æ”¶HTTPè¯·æ±‚å¹¶è°ƒç”¨ä½ å†™çš„Servlet ä»£ç å¤„ç†è¯·æ±‚ã€‚

### åˆå§‹åŒ– `init()` --åªè°ƒç”¨ä¸€æ¬¡

* åœ¨Servletç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶ï¼Œå®¹å™¨ä¼šåˆ›å»ºä¸€ä¸ªServletå®ä¾‹ï¼Œç„¶åè°ƒç”¨å®ƒçš„ `init()`æ–¹æ³•ã€‚
* é€šå¸¸ç”¨æ¥åšèµ„æºçš„åˆå§‹åŒ–æ“ä½œã€æ¯”å¦‚æ•°æ®åº“è¿æ¥ã€è¯»å–é…ç½®æ–‡ä»¶ç­‰ã€‚

```java
@Override
public void init() throws ServletException {
    System.out.println("Servlet åˆå§‹åŒ–ï¼šinit()");
}
```

> æ³¨ï¼šåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œinit()åªè°ƒç”¨ä¸€æ¬¡

### è¯·æ±‚å¤„ç† `service()`--æ¯æ¬¡è¯·æ±‚éƒ½ä¼šè°ƒç”¨

* æ¯æ¬¡æœ‰å®¢æˆ·ç«¯è¯·æ±‚Servletï¼ŒTomcatå°±ä¼šè°ƒç”¨Servletå®ä¾‹çš„ `service()` æ–¹æ³•
* `service() `å®ä¾‹ä¼šè‡ªåŠ¨åˆ¤æ–­è¯·æ±‚ç±»å‹(GET/POST)ï¼Œç„¶ååˆ†å‘ç»™å¯¹åº”çš„doGet() æˆ– doPost()

```java
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.getWriter().write("å¤„ç† GET è¯·æ±‚");
}

@Override
protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.getWriter().write("å¤„ç† POST è¯·æ±‚");
}

```

> æ³¨ï¼šæ­¤å¤„æˆ‘ä»¬å…ˆæš‚æ—¶äº†è§£å¤§æ¦‚æµç¨‹ï¼Œæ— éœ€å…³å¿ƒä»£ç å®é™…å®ç°

### é”€æ¯ `destroy()`--åªè°ƒç”¨ä¸€æ¬¡

* å½“Tomcatå…³é—­ã€æˆ–Servletè¢«å¸è½½(å¦‚çƒ­æ›´æ–°æ—¶)ï¼Œå®¹å™¨ä¼šè°ƒç”¨ `destroy()`æ–¹æ³•
* é€šå¸¸ç”¨æ¥é‡Šæ”¾èµ„æºï¼Œå¦‚å…³é—­æ•°æ®åº“è¿æ¥ï¼Œåœæ­¢çº¿ç¨‹ç­‰ã€‚

```java
@Override
public void destroy() {
    System.out.println("Servlet è¢«é”€æ¯ï¼šdestroy()");
}
```

### è¡¥å……è¯´æ˜

1. **ä¸€ä¸ª**Servletç±»åªè¢«å®ä¾‹åŒ–ä¸€æ¬¡(å•ä¾‹)ï¼Œå¤šä¸ªè¯·æ±‚å…¬ç”¨ä¸€ä¸ªå®ä¾‹ï¼Œçº¿ç¨‹ä¸å®‰å…¨ã€‚
2. Servletç”Ÿå‘½å‘¨æœŸç”±å®¹å™¨è‡ªåŠ¨ç®¡ç†ï¼Œä½ æ— éœ€æ‰‹åŠ¨è°ƒç”¨è¿™äº›æ–¹æ³•
3. SpringMVCçš„ä½å±‚DispatchServletä¹Ÿæ˜¯ä¸€ä¸ªServletï¼Œç”Ÿå‘½å‘¨æœŸå’Œä½ å†™çš„ä¸€æ ·ã€‚

## éƒ¨ç½²Tomcat

> Apache åŸºé‡‘ä¼šå¼€å‘çš„å…è´¹ã€å¼€æºã€è½»é‡çº§  **Java Web å®¹å™¨** ï¼Œæ”¯æŒ Servlet å’Œ JSP è§„èŒƒ
>
> * SpringBoot + SpringMVC ä¸­å†…ç½®Tomcatï¼Œæ— éœ€é…ç½®å®¹å™¨ï¼Œç›´æ¥Mainæ–¹æ³•è¿è¡Œã€‚

é¦–å…ˆæˆ‘ä»¬åœ¨å®˜ç½‘ä¸‹è½½å®‰è£…TomCatï¼š[Apache TomcatÂ® - Welcome!](https://tomcat.apache.org/)

å®‰è£…åè®°ä½å®‰è£…è·¯å¾„ï¼Œåé¢è¦ç”¨ã€‚

ç„¶åæˆ‘ä»¬åœ¨VScodeä¸­å®‰è£…æ‰©å±•ï¼š

![1747657005375](image/java-WebåŸºç¡€_20250519_165356/1747657005375.webp)

è¿™ä¸ªæ‰©å±•å¸®åŠ©æˆ‘ä»¬ç®¡ç†å’Œå¯åŠ¨Tomcatã€‚

å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬åœ¨VScodeçš„ä¾§è¾¹æ ä¸­çš„SERVICEä¸­æ‰¾åˆ°è¿™ä¸ªæ‰©å±•(æ³¨æ„åœ¨èµ„æºç®¡ç†å™¨æ çš„æœ€ä¸‹é¢)ï¼š

![1747657081823](image/java-WebåŸºç¡€_20250519_165356/1747657081823.webp)

æˆ‘ä»¬å³é”®è¿™ä¸ªæœåŠ¡é€‰æ‹©ï¼šCreat New Server

ç°åœ¨æˆ‘ä»¬æŸ¥çœ‹VScodeçš„æœ€ä¸Šé¢ï¼Œè¯¢é—®æˆ‘ä»¬æ˜¯å¦éœ€è¦ä¸‹è½½serverï¼Œç”±äºæˆ‘ä»¬ä¹‹å‰å·²ç»æ‰‹åŠ¨ä¸‹è½½è¿‡Tomcatï¼Œæ‰€ä»¥é€‰æ‹©Noã€‚

ç„¶åæˆ‘ä»¬åœ¨å¼¹å‡ºçš„çª—å£ä¸­é€‰æ‹©ä¹‹å‰å®‰è£…çš„Tomcatçš„æ–‡ä»¶å¤¹ï¼Œæ¥åˆ°è¿™ä¸ªé¡µé¢ï¼š

![1747657319639](image/java-WebåŸºç¡€_20250519_165356/1747657319639.webp)

ä¸ç”¨æ›´æ”¹é…ç½®ï¼Œç›´æ¥æ»‘å€’æœ€ä¸‹é¢ç‚¹å‡»Finishå³å¯ã€‚

ç°åœ¨æˆ‘ä»¬çœ‹åˆ°æ‰©å±•ä¸­å·²ç»æ‰˜ç®¡äº†Tomcatï¼š

![1747657387304](image/java-WebåŸºç¡€_20250519_165356/1747657387304.webp)

ç°åœ¨æˆ‘ä»¬åˆ›å»ºé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

```
servlet-lifecycle-demo/
â”œâ”€â”€ pom.xml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â””â”€â”€ com/example/LifecycleServlet.java

```

pom.xmlæ–‡ä»¶å¦‚ä¸‹ï¼š

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                             http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.example</groupId>
    <artifactId>servlet-lifecycle-demo</artifactId>
    <version>1.0-SNAPSHOT</version>
    <packaging>war</packaging>

    <dependencies>
        <!-- Servlet API -->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>4.0.1</version>
            <scope>provided</scope>
        </dependency>
    </dependencies>

    <build>
        <finalName>servlet-lifecycle-demo</finalName>
        <plugins>
            <!-- Maven war æ’ä»¶ -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-war-plugin</artifactId>
                <version>3.3.1</version>
            </plugin>
        </plugins>
    </build>
</project>

```

LifecycleServlet.java æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```java
package com.example;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import java.io.IOException;

@WebServlet("/life")
public class LifecycleServlet extends HttpServlet {

    public LifecycleServlet() {
        System.out.println("ğŸš€ æ„é€ æ–¹æ³•ï¼šServlet å®ä¾‹è¢«åˆ›å»º");
    }

    @Override
    public void init() throws ServletException {
        System.out.println("ğŸ”§ init()ï¼šServlet è¢«åˆå§‹åŒ–");
    }

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {
        System.out.println("ğŸ“¥ doGet()ï¼šå¤„ç† GET è¯·æ±‚");
        resp.setContentType("text/html;charset=UTF-8");
        resp.getWriter().write("<h2>ä½ å¥½ï¼Œè¿™æ˜¯ Servlet ç”Ÿå‘½å‘¨æœŸæ¼”ç¤º</h2>");
    }

    @Override
    public void destroy() {
        System.out.println("ğŸ§¹ destroy()ï¼šServlet è¢«é”€æ¯");
    }
}

```

ç„¶åæˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­è¾“å…¥ï¼š

```bash
mvn clean package
```

å¥½ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦å³é”®Tomcaté€‰æ‹©ï¼šadd Deployment

![1747657850124](image/java-WebåŸºç¡€_20250519_165356/1747657850124.webp)

ç„¶åé€‰æ‹©File:

![1747657911662](image/java-WebåŸºç¡€_20250519_165356/1747657911662.webp)

é€‰æ‹©æˆ‘ä»¬åˆšåˆšç¼–è¯‘å¥½çš„weræ–‡ä»¶ï¼š

![1747658001528](image/java-WebåŸºç¡€_20250519_165356/1747658001528.webp)

æœ€åé€‰æ‹©Noï¼š

![1747657966359](image/java-WebåŸºç¡€_20250519_165356/1747657966359.webp)

æˆ‘ä»¬å°±å°†åˆšåˆšç¼–å†™å¥½çš„ServletåŠ å…¥äº†Tomcatå®¹å™¨ä¸­ã€‚

å³é”®TomcatæœåŠ¡é€‰æ‹©Start Serverï¼ŒæœåŠ¡å¼€å§‹è¿è¡Œã€‚æ­¤æ—¶æ‰“å°çš„ä¿¡æ¯åªæœ‰Tomcatçš„å¯åŠ¨ä¿¡æ¯ï¼ŒServletè¿˜æ²¡æœ‰è¢«åˆ›å»ºã€‚

![1747658502463](image/java-WebåŸºç¡€_20250519_165356/1747658502463.webp)

ç„¶åæˆ‘ä»¬æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8080/servlet-lifecycle-demo/life`

çœ‹åˆ°servletå®ä¾‹è¢«åˆ›å»ºï¼Œç„¶åè°ƒç”¨äº†ä¸€æ¬¡GETè¯·æ±‚ï¼Œ

![1747658529418](image/java-WebåŸºç¡€_20250519_165356/1747658529418.webp)

ä¹‹åå†æ¬¡è®¿é—®é¡µé¢ï¼Œä¹Ÿä¸ä¼šåœ¨åˆ›å»ºæ–°çš„Servletå®ä¾‹ï¼Œè€Œæ˜¯ä¸€ç›´è°ƒç”¨åŒä¸€ä¸ªå®ä¾‹çš„doGetæ–¹æ³•

![1747658627861](image/java-WebåŸºç¡€_20250519_165356/1747658627861.webp)

æœ€åæˆ‘ä»¬Stop Serverï¼š

![1747658665412](image/java-WebåŸºç¡€_20250519_165356/1747658665412.webp)

æˆ‘ä»¬å¯ä»¥åœ¨æ—¥å¿—ä¸­æ‰¾åˆ°Servleté”€æ¯å‡½æ•°è°ƒç”¨æ˜¯æ‰“å°çš„æ—¥å¿—ã€‚

## Servlet Mapping

Servletçš„ä½œç”¨æ˜¯å°†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚URLè·¯å¾„ä¸ç‰¹å®šçš„Servlet ç±»å…³è”èµ·æ¥ã€‚å½“æ¥æ”¶åˆ°ç¬¦åˆæŸä¸ªæ˜ å°„è§„åˆ™çš„è¯·æ±‚æ—¶ï¼Œå®ƒä¼šå°†è¯·æ±‚äº¤ç»™å¯¹åº”çš„Servletæ¥å¤„ç†ã€‚

### ä½¿ç”¨ `@WebServlet`æ³¨è§£é…ç½®æ˜ å°„

åœ¨æˆ‘ä»¬ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨

```java
@WebServlet("/life")
public class LifecycleServlet extends HttpServlet
```

è¿›è¡Œæ³¨è§£é…ç½®ã€‚è¿™é‡Œçš„"/life" å°±æ˜¯ä¸€ä¸ªURLæ¨¡å¼(URL pattern), å½“ç”¨æˆ·è®¿é—®è·¯å¾„ `/life` æ—¶ï¼ŒTomcatå°±ä¼šå°†è¿™ä¸ªè¯·æ±‚äº¤ç»™ `LifecycleServlet`çš„å®ä¾‹æ¥å¤„ç†ã€‚

* å¤šä¸ªURLæ¨¡å¼ï¼šå¯ä»¥ä¸ºä¸€ä¸ªServletæ˜ å°„å¤šä¸ªURLæ¨¡å¼

  ```java
  @WebServlet({"/life","/mylife"})
  ```

  è¿™æ ·å½“è®¿é—®å¤šä¸ªè·¯å¾„ä¸­çš„ä»»æ„ä¸€ä¸ªè·¯å¾„æ—¶ï¼Œéƒ½ä¼šäº¤ç»™ `LifecycleServlet`å®ä¾‹è¿›è¡Œå¤„ç†
* æŒ‡å®š `name` :å¯ä»¥ä¸ºServletæŒ‡å®šä¸€ä¸ªåç§°

  ```java
  @WebServlet(name = "lifecycleServlet", urlPatterns = {"/life"})
  public class LifecycleServlet extends HttpServlet {
      // ... your code ...
  }
  ```

  åœ¨æ³¨è§£æ˜ å°„æ—¶ï¼Œnameå±æ€§é€šå¸¸ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯åœ¨web.xmlä¸­ï¼Œservlet-nameå±æ€§æ˜¯å¿…é¡»çš„ï¼Œæ‰€ä»¥è¿™é‡Œä»‹ç»ä¸€ä¸‹ã€‚

### ä½¿ç”¨ `web.xml`é…ç½®æ˜ å°„(ä¼ ç»Ÿæ–¹å¼)

åœ¨webåº”ç”¨çš„ `WEB-INF`ç›®å½•ä¸‹ï¼Œä¼šæœ‰ä¸€ä¸ªweb.xmlæ–‡ä»¶ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ–‡ä»¶è¿›è¡ŒServleté…ç½®å’ŒServletæ˜ å°„ã€‚

```xml
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <servlet>
        <servlet-name>lifecycleServlet</servlet-name>
        <servlet-class>com.example.LifecycleServlet</servlet-class>
    </servlet>

    <servlet-mapping>
        <servlet-name>lifecycleServlet</servlet-name>
        <url-pattern>/life</url-pattern>
    </servlet-mapping>

</web-app>
```

* `<servlet>` ç”¨äºå£°æ˜ä¸€ä¸ªServletï¼Œé€šè¿‡ `<servlet-name>`æŒ‡å®šåç§°(å¿…é¡»)ï¼Œ`<servlet-class>`æŒ‡å®šServletç±»çš„å®Œæ•´é™å®šåã€‚
* `<servlet-mapping>`å…ƒç´ ç”¨äºå°†ä¸€ä¸ªServletåç§° `<servlet-name>`æ˜ å°„åˆ°ä¸€ä¸ªURLæ¨¡å¼ `<url-pattern>`

### URLæ¨¡å¼çš„ç±»å‹

* ç²¾ç¡®åŒ¹é…ï¼šä»¥ `/`å¼€å¤´ï¼Œä¾‹å¦‚ `/life`ã€‚åªç”¨å½“è¯·æ±‚çš„è·¯å¾„ä¸æ­¤è·¯å¾„å®Œå…¨åŒ¹é…æ—¶ï¼ŒServletæ‰ä¼šè¢«è°ƒç”¨ã€‚
* è·¯å¾„åŒ¹é…ï¼šä»¥ `/`å¼€å¤´ï¼Œä»¥ `/*`ç»“å°¾ï¼Œä¾‹å¦‚ `/admin/*`ã€‚ä»»ä½•ä»¥ `/admin/` å¼€å¤´çš„è¯·æ±‚éƒ½ä¼šè¢«åŒ¹é…åˆ°è¿™ä¸ªServletã€‚
* æ‰©å±•ååŒ¹é…ï¼šä»¥ `*.` å¼€å¤´ï¼Œä¾‹å¦‚ `*.do`ã€‚ä»»ä½•ä»¥ `.do`ç»“å°¾çš„è¯·æ±‚éƒ½ä¼šè¢«åŒ¹é…åˆ°è¿™ä¸ªServlet
* é»˜è®¤Servletï¼šåªæœ‰ä¸€ä¸ª `/`ä½œä¸ºURLæ¨¡å¼ï¼Œä»–ä¼šå¤„ç†æ‰€æœ‰å…¶ä»–Servletæ˜ å°„éƒ½æ— æ³•åŒ¹é…çš„è¯·æ±‚ã€‚

## Servletç‰¹æ€§

### Servletçš„çº¿ç¨‹å®‰å…¨æ€§ï¼š

* Servletå®ä¾‹æ˜¯**å•ä¾‹**çš„ï¼Œä½†æ˜¯å¯¹äºæ¯ä¸ªè¯·æ±‚ï¼ŒServletå®¹å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ª**æ–°çš„çº¿ç¨‹**æ¥æ‰§è¡ŒServletçš„ `service()`æ–¹æ³•(`doGet()`æˆ– `doPost()`)
* Servletéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨æ€§ã€‚é¿å…åœ¨Servletçš„å®ä¾‹å˜é‡ä¸­å­˜å‚¨å…±äº«çš„å¯å˜çŠ¶æ€ï¼Œæˆ–è€…é‡‡å–åŒæ­¥æªæ–½æ¥ä¿æŠ¤å…±äº«èµ„æºã€‚

## Servletçš„é…ç½®(ServletConfig)ï¼š

* ServletConfig å¯¹è±¡ä»£è¡¨Servletçš„é…ç½®ä¿¡æ¯ï¼Œæ¯ä¸ªservletéƒ½æœ‰è‡ªå·±çš„ServletConfig**å¯¹è±¡**ã€‚
* æˆ‘ä»¬å¯ä»¥åœ¨ `web.xml `(æˆ–ä½¿ç”¨ `@WebInitParam` æ³¨è§£)ä¸ºServleté…ç½®åˆå§‹åŒ–å‚æ•°ï¼Œå¹¶é€šè¿‡ `ServletConfig`çš„ `getInitParameter(String name) `æ–¹æ³•è·å–ã€‚

#### ä¸€ä¸ªå°DEMO

* ä½¿ç”¨ServletConfigè·å–åˆå§‹åŒ–å‚æ•°ï¼š

```xml
<servlet>
        <servlet-name>helloConfig</servlet-name>
        <servlet-class>com.example.HelloConfig</servlet-class>
        <init-param>
            <param-name>exampleParam</param-name>
            <param-value>Hello from config!</param-value>
        </init-param>
</servlet>
```

```java
public class HelloConfig extends HttpServlet {

    private String exampleParam;

    @Override
    public void init(ServletConfig config) throws ServletException {
        super.init(config);
        exampleParam = config.getInitParameter("exampleParam");
    }
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {
        resp.setContentType("text/html;charset=UTF-8");
        resp.getWriter().write("<h2>" + exampleParam + "</h2>");
    }

}
```

* ä½¿ç”¨ `@WebInitParam` æ³¨è§£

```java
@WebServlet(urlPatterns = "/hello")
@WebInitParam(name = "exampleParam", value = "Hello from annotation!")
public class HelloAnnotation extends HttpServlet {
    private String exampleParam;

    @Override
    public void init(ServletConfig config) throws ServletException {
        super.init(config);
        exampleParam= config.getInitParameter("exampleParam");
        System.out.println("Greeting from annotation: " + exampleParam);
    }

    // ... doGet method ...
}

```

æ— è®ºä½¿ç”¨**æ³¨è§£**è¿˜æ˜¯**web.xml**åœ¨Servletç±»ä¸­è·å–åˆå§‹åŒ–å‚æ•°çš„æ–¹æ³•éƒ½ä¸€æ ·ã€‚åªæ˜¯æ³¨å†Œå‚æ•°çš„æ–¹æ³•ä¸åŒã€‚

## Servlet APIè¯¦è§£

Servlet API æ˜¯æ„å»ºJava Web åº”ç”¨çš„æ ¸å¿ƒã€‚å®ƒå®šä¹‰äº†Servletå®¹å™¨å’Œä½ çš„Servletä¹‹é—´çš„å¥‘çº¦ã€‚

### HttpServletRequest æ¥å£

`HttpServletRequest` å¯¹è±¡ä»£è¡¨äº†å®¢æˆ·ç«¯å‘é€ç»™Servletçš„HTTPè¯·æ±‚ã€‚é€šè¿‡è¿™ä¸ªå¯¹è±¡ï¼Œä½ å¯ä»¥è·å–åˆ°è¯·æ±‚çš„**æ‰€æœ‰**ä¿¡æ¯ã€‚

**å¸¸ç”¨æ–¹æ³•ï¼š**

> è·å–å‚æ•°æ—¶ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¯¥å‚æ•°ï¼Œåˆ™ä¼šå¾—åˆ° `null`

* `getParameter(String name)`: è·å–æŒ‡å®šåç§°çš„è¯·æ±‚å‚æ•°çš„å€¼ï¼ˆè¿”å› `String`ï¼‰ã€‚å¦‚æœå‚æ•°ä¸å­˜åœ¨æˆ–æœ‰å¤šä¸ªåŒåå‚æ•°ï¼Œè¡Œä¸ºå¯èƒ½ä¸ç¡®å®šã€‚
* `getParameterValues(String name)`: è·å–æŒ‡å®šåç§°çš„æ‰€æœ‰è¯·æ±‚å‚æ•°çš„å€¼ï¼ˆè¿”å› `String[]`ï¼‰ã€‚
* `getParameterMap()`: è·å–æ‰€æœ‰è¯·æ±‚å‚æ•°çš„ `Map<String, String[]>`ã€‚
* `getHeader(String name)`: è·å–æŒ‡å®šåç§°çš„è¯·æ±‚å¤´çš„å€¼ï¼ˆè¿”å› `String`ï¼‰ã€‚
* `getHeaders(String name)`: è·å–æŒ‡å®šåç§°çš„æ‰€æœ‰è¯·æ±‚å¤´çš„å€¼ï¼ˆè¿”å› `Enumeration<String>`ï¼‰ã€‚
* `getHeaderNames()`: è·å–æ‰€æœ‰è¯·æ±‚å¤´çš„åç§°ï¼ˆè¿”å› `Enumeration<String>`ï¼‰ã€‚
* `getMethod()`: è·å–è¯·æ±‚çš„ HTTP æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼š"GET", "POST"ï¼‰ã€‚
* `getRequestURI()`: è·å–è¯·æ±‚çš„ URIã€‚
* `getContextPath()`: è·å– Web åº”ç”¨çš„ä¸Šä¸‹æ–‡è·¯å¾„ã€‚
* `getServletPath()`: è·å– Servlet çš„è·¯å¾„ã€‚
* `getQueryString()`: è·å–æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆURL ä¸­ `?` åé¢çš„éƒ¨åˆ†ï¼‰ã€‚
* `getRemoteAddr()`: è·å–å‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯çš„ IP åœ°å€ã€‚
* `getRemoteHost()`: è·å–å‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯çš„ä¸»æœºåã€‚
* `getSession()`: è¿”å›å½“å‰è¯·æ±‚å…³è”çš„ `HttpSession`ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚
* `getSession(boolean create)`: è¿”å›å½“å‰è¯·æ±‚å…³è”çš„ `HttpSession`ï¼Œå¦‚æœ `create` ä¸º `true` ä¸”ä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œå¦åˆ™è¿”å› `null`ã€‚
* `setAttribute()`ï¼š`HttpServletRequest` çš„å±æ€§åªåœ¨å½“å‰è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹ä¸­æœ‰æ•ˆï¼Œå½“è¯¥è¯·æ±‚çš„å“åº”å‘é€å›å®¢æˆ·ç«¯åï¼Œè¿™äº›å±æ€§å°±ä¸å†éœ€è¦äº†
* `getAttribute()`ï¼šè·å–è®¾ç½®çš„å±æ€§ã€‚

> ç»ƒä¹ 1ï¼šè·å–getè¯·æ±‚ä¸­çš„å‚æ•° `name=ulna&age=20`

```java
package com.example;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import java.io.IOException;
import javax.servlet.ServletConfig;

import java.util.Enumeration;
import java.util.Map;


@WebServlet(name = "Test1", urlPatterns = {"/test1"})
public class HttpServletRequestTest1 extends HttpServlet {


    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {
        // è·å–è¯·æ±‚å‚æ•°çš„æœ€ä½³å®è·µ

        //ç›´æ¥è·å–å‚æ•°
        String name = req.getParameter("name");
        String age = req.getParameter("age");       //ç¼ºå°‘å‚æ•°è·å–å€¼null
  
        // é€šè¿‡Mapæ–¹æ³•è·å–
        Map <String, String[]> parameterMap = req.getParameterMap();
  
        String nameMap = parameterMap.get("name")[0];
        //String ageMap = parameterMap.get("age")[0];     //å¦‚æœå°‘å‚æ•°ä¼šæŠ¥é”™
        String ageMap = null;                             //ä½¿ç”¨Mapåœ¨è·å–å€¼ä¹‹å‰éœ€è¦åˆ¤æ–­æ˜¯å¦å­˜åœ¨
        if (parameterMap.containsKey("age")) {
            ageMap = parameterMap.get("age")[0];
        }

        // è·å–è¯·æ±‚å¤´çš„æœ€ä½³å®è·µ
        // è·å–æ‰€æœ‰è¯·æ±‚å¤´åç§°
        Enumeration<String> headerNames = req.getHeaderNames();     //è·å–æ‰€æœ‰è¯·æ±‚å¤´åç§°


        // åªè·å–æƒ³è¦çš„è¯·æ±‚å¤´
        String userAgent = req.getHeader("user-agent");  //è·å–User-Agentè¯·æ±‚å¤´
        System.out.println("User-Agent: " + userAgent);

        // è®¾ç½®å“åº”å†…å®¹ç±»å‹
        resp.setContentType("text/html;charset=UTF-8");

        // è¾“å‡ºå“åº”å†…å®¹
        resp.getWriter().println("<html><body>");
        resp.getWriter().println("<h1>Request Method: " + req.getMethod() + "</h1>");
        resp.getWriter().println("<h1>Received Parameters</h1>");
        resp.getWriter().println("<p>Name: " + name + "</p>");
        resp.getWriter().println("<p>Age: " + age + "</p>");
        resp.getWriter().println("<h2>Using Map Method</h2>");
        resp.getWriter().println("<p>Name from Map: " + nameMap + "</p>");
        resp.getWriter().println("<p>Age from Map: " + ageMap + "</p>");
        resp.getWriter().println("<h2>Request Headers</h2>");
        while (headerNames.hasMoreElements()) {     //åƒè¿­ä»£å™¨ä¸€æ ·è®¿é—®è¯·æ±‚å¤´
            String headerName = headerNames.nextElement();
            //å¯ä»¥åœ¨è¿™é‡Œå¯¹è¯·æ±‚å¤´è¿›è¡Œå¤„ç†
            String headerValue = req.getHeader(headerName);
            resp.getWriter().println("<p>" + headerName + ": " + headerValue + "</p>");
        }
        // è¾“å‡ºä¸Šä¸‹æ–‡è·¯å¾„
        resp.getWriter().println("<h1>Context Path: " + req.getContextPath() + "</h1>");  //å½“å‰åº”ç”¨çš„ä¸Šä¸‹æ–‡è·¯å¾„
        // è¾“å‡ºServletè·¯å¾„
        resp.getWriter().println("<h1>Servlet Path: " + req.getServletPath() + "</h1>");  //å½“å‰Servletå®ä¾‹çš„è·¯å¾„
        // å®é™…è®¿é—®çš„è·¯å¾„ = ä¸Šä¸‹æ–‡è·¯å¾„ + Servletè·¯å¾„
  
        resp.getWriter().println("</body></html>");
    }

}

```

### HttpServletResponse æ¥å£

`HttpServletResponse` å¯¹è±¡ä»£è¡¨äº†Servletå‘é€ç»™å®¢æˆ·ç«¯çš„Httpå“åº”ã€‚é€šè¿‡è¿™ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å“åº”çš„**å†…å®¹**ã€**çŠ¶æ€ç **ã€**å“åº”å¤´**ç­‰ä¿¡æ¯ã€‚

**å¸¸ç”¨æ–¹æ³•ï¼š**

* `getWriter()`: è¿”å›ä¸€ä¸ª `PrintWriter` å¯¹è±¡ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒå‘å®¢æˆ·ç«¯å‘é€æ–‡æœ¬æ•°æ®ã€‚
* `getOutputStream()`: è¿”å›ä¸€ä¸ª `ServletOutputStream` å¯¹è±¡ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒå‘å®¢æˆ·ç«¯å‘é€äºŒè¿›åˆ¶æ•°æ®ï¼ˆä¾‹å¦‚ï¼šå›¾ç‰‡ã€æ–‡ä»¶ï¼‰ã€‚
* `setContentType(String type)`: è®¾ç½®å“åº”çš„å†…å®¹ç±»å‹ï¼ˆä¾‹å¦‚ï¼š"text/html", "application/json"ï¼‰ã€‚åŒæ—¶ä¹Ÿå¯ä»¥è®¾ç½®å­—ç¬¦ç¼–ç ï¼Œä¾‹å¦‚ `"text/html;charset=UTF-8"`ã€‚
* `setStatus(int sc)`: è®¾ç½®å“åº”çš„çŠ¶æ€ç ï¼ˆä¾‹å¦‚ï¼š200, 404, 500ï¼‰ã€‚
* `sendError(int sc, String msg)`: å‘é€ä¸€ä¸ªé”™è¯¯å“åº”åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶è®¾ç½®çŠ¶æ€ç å’Œé”™è¯¯æ¶ˆæ¯ã€‚
* `sendRedirect(String location)`: å‘é€ä¸€ä¸ªä¸´æ—¶çš„é‡å®šå‘å“åº”ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯æµè§ˆå™¨å»è®¿é—®å¦ä¸€ä¸ª URLã€‚
* `setHeader(String name, String value)`: è®¾ç½®æŒ‡å®šçš„å“åº”å¤´ã€‚
* `addHeader(String name, String value)`: æ·»åŠ æŒ‡å®šçš„å“åº”å¤´ï¼ˆå…è®¸æœ‰å¤šä¸ªåŒå headerï¼‰ã€‚
* `setDateHeader(String name, long date)`: è®¾ç½®æ—¥æœŸæ ¼å¼çš„å“åº”å¤´ã€‚
* `setIntHeader(String name, int value)`: è®¾ç½®æ•´æ•°æ ¼å¼çš„å“åº”å¤´ã€‚
* `setContentLength(int len)`: è®¾ç½®å“åº”å†…å®¹çš„é•¿åº¦ã€‚

> ç»ƒä¹ 2ï¼šåˆ›å»ºä¸€ä¸ªServletï¼Œå½“é€šè¿‡è®¿é—®ç‰¹å®šçš„URLæ—¶å¦‚ï¼š`/redirect-me` , ä»–ä¼šä½¿ç”¨sendRedirect() æ–¹æ³•å°†å®¢æˆ·ç«¯é‡å®šå‘åˆ°å¦ä¸€ä¸ªä½ æŒ‡å®šçš„URLä¾‹å¦‚ï¼š`https://www.google.com`

```java
@WebServlet(name = "Redirect", urlPatterns = {"/redirect-me"})
public class HttpServletRequestTest1 extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {
                resp.sendRedirect("https://www.google.com");
    }

}
```

### ServletConfig æ¥å£

æ¯ä¸ªServletéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ `ServletConfig` å¯¹è±¡ï¼ŒServlet å®¹å™¨åœ¨æ„å»ºServletæ—¶ä¼šåˆ›å»ºè¿™ä¸ªå¯¹è±¡ï¼Œå¹¶ä¼ é€’ç»™Servletçš„ `init(ServletConfig config)`æ–¹æ³•ã€‚`ServletConfig` æ¥å£å…è®¸ä½ è®¿é—®Servletçš„é…ç½®ä¿¡æ¯ã€‚

æ³¨å†Œåˆå§‹å‚æ•°ï¼š

åªæœ‰ä¸€ä¸ªå‚æ•°æ—¶ï¼šé€šå¸¸å¯ä»¥è¿™æ ·ç®€åŒ–å†™

```java
@WebServlet(name = "ConfigTest", urlPatterns = {"/configTest"})
@WebInitParam(name = "param1", value = "value1")
public class ConfigTest extends HttpServlet
```

å¤šä¸ªå‚æ•°æ—¶ï¼šè§„èŒƒå†™æ³•

```java
@WebServlet(name = "ConfigTest",
            urlPatterns = {"/configTest"},
            initParams = {
                @WebInitParam(name = "param1", value = "value1"),
                @WebInitParam(name = "param2", value = "value2"),
            })
public class ConfigTest extends HttpServlet
```

**å¸¸ç”¨æ–¹æ³•ï¼š**

* `getServletName()`: è¿”å› Servlet çš„åç§°ï¼Œé€šå¸¸æ˜¯åœ¨ `web.xml` æˆ–ä½¿ç”¨ `@WebServlet` æ³¨è§£æ—¶æŒ‡å®šçš„ã€‚
* `getInitParameter(String name)`: è¿”å› Servlet åˆå§‹åŒ–å‚æ•°ä¸­æŒ‡å®šåç§°çš„å€¼ï¼ˆè¿”å› `String`ï¼‰ã€‚è¿™äº›å‚æ•°å¯ä»¥åœ¨ `web.xml` ä¸­é€šè¿‡ `<init-param>` æ ‡ç­¾é…ç½®ï¼Œæˆ–è€…åœ¨ä½¿ç”¨æ³¨è§£æ—¶é€šè¿‡ `@WebInitParam` é…ç½®ã€‚
* `getInitParameterNames()`: è¿”å›åŒ…å«æ‰€æœ‰ Servlet åˆå§‹åŒ–å‚æ•°åç§°çš„ `Enumeration<String>`.
* `getServletContext()`: è¿”å›å½“å‰ Web åº”ç”¨çš„ `ServletContext` å¯¹è±¡ã€‚

> ç»ƒä¹ 3ï¼šåˆ›å»ºä¸€ä¸ªServletï¼Œé€šè¿‡ `@WebInitPara` æ³¨è§£é…ç½®è‡³å°‘ä¸¤ä¸ªåˆå§‹åŒ–å‚æ•°ã€‚åœ¨Servletçš„ `doGet()` æ–¹æ³•ä¸­è·å–å¹¶æ˜¾ç¤ºè¿™äº›åˆå§‹åŒ–å‚æ•°çš„å€¼ä»¥åŠservletçš„åç§°ã€‚

```java
@WebServlet(name = "ConfigTest",
            urlPatterns = {"/configTest"},
            initParams = {
                @WebInitParam(name = "param1", value = "value1"),
                @WebInitParam(name = "param2", value = "value2"),
            })
public class ConfigTest extends HttpServlet {
    private String param1;
    private String param2;

    @Override
    public void init(ServletConfig config) throws ServletException{
        super.init(config);
        param1 = config.getInitParameter("param1");
        param2 = config.getInitParameter("param2");
    }

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {
  
        resp.setContentType("text/plain");
        resp.getWriter().println("Servlet Name: " + getServletConfig().getServletName());	//servletä¸­ä»»ä½•åœ°æ–¹å¯ä»¥ä½¿ç”¨getServletConfig()è·å–è¯¥Servletçš„Config
        resp.getWriter().println("Param1: " + param1);
        resp.getWriter().println("Param2: " + param2);
    }

}
```

### ServletContext æ¥å£

`ServletContext` æ¥å£ä»£è¡¨äº†å½“å‰çš„Webåº”ç”¨ç¨‹åºã€‚å®ƒæ˜¯æ•´ä¸ªWebåº”ç”¨å…±äº«çš„ä¸Šä¸‹æ–‡ï¼Œæ‰€æœ‰çš„Servletã€Filterã€Listener ç­‰éƒ½å¯ä»¥è®¿é—®åŒä¸€ä¸ª `ServletContext`å¯¹è±¡ã€‚Servlet å®¹å™¨åœ¨å¯åŠ¨Webåº”ç”¨æ—¶åˆ›å»º `ServletContext`å¯¹è±¡ã€‚

**å¸¸ç”¨æ–¹æ³•ï¼š**

* `getAttribute(String name)`: è¿”å›æŒ‡å®šåç§°çš„åº”ç”¨ç¨‹åºçº§åˆ«çš„å±æ€§å€¼ï¼ˆè¿”å› `Object`ï¼‰ã€‚
* `setAttribute(String name, Object object)`: è®¾ç½®åº”ç”¨ç¨‹åºçº§åˆ«çš„**å±æ€§/å¯¹è±¡**ã€‚
* `removeAttribute(String name)`: ç§»é™¤æŒ‡å®šåç§°çš„åº”ç”¨ç¨‹åºçº§åˆ«çš„å±æ€§ã€‚
* `getInitParameter(String name)`: è¿”å› Web åº”ç”¨çš„ä¸Šä¸‹æ–‡åˆå§‹åŒ–å‚æ•°ä¸­æŒ‡å®šåç§°çš„å€¼ï¼ˆè¿”å› `String`ï¼‰ã€‚è¿™äº›å‚æ•°åœ¨ `web.xml` çš„ `<context-param>` æ ‡ç­¾ä¸­é…ç½®ã€‚
* `getInitParameterNames()`: è¿”å›åŒ…å«æ‰€æœ‰ Web åº”ç”¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–å‚æ•°åç§°çš„ `Enumeration<String>`.
* `getResource(String path)`: è¿”å›æŒ‡å®šè·¯å¾„çš„èµ„æº URLã€‚è·¯å¾„ä»¥ `/` å¼€å¤´ï¼Œç›¸å¯¹äº Web åº”ç”¨çš„æ ¹ç›®å½•ã€‚
* `getResourceAsStream(String path)`: è¿”å›æŒ‡å®šè·¯å¾„çš„èµ„æºè¾“å…¥æµã€‚
* `getContextPath()`: è¿”å› Web åº”ç”¨çš„ä¸Šä¸‹æ–‡è·¯å¾„ã€‚
* `getServletContextName()`: è¿”å› Web åº”ç”¨çš„åç§°ï¼ˆå¦‚æœåœ¨éƒ¨ç½²æè¿°ç¬¦ä¸­æŒ‡å®šäº†ï¼‰ã€‚
* `log(String msg)`: å°†æ¶ˆæ¯å†™å…¥ Servlet å®¹å™¨çš„æ—¥å¿—ã€‚

> ç»ƒä¹ 4ï¼š
>
> 1. åœ¨ä½ çš„webåº”ç”¨çš„web.xmlæ–‡ä»¶ç§é…ç½®è‡³å°‘ä¸€ä¸ª `<context-param>`
> 2. åˆ›å»ºä¸€ä¸ªServletï¼Œè¯¥Servlet è·å–å¹¶æ˜¾ç¤ºè¿™ä¸ªä¸Šä¸‹æ–‡å‚æ•°çš„å€¼ã€‚
> 3. åœ¨è¯¥Servletä¸­ï¼Œè®¾ç½®ä¸€ä¸ªServletContextå±æ€§ï¼Œå¹¶åœ¨åŒä¸€ä¸ªServletä¸­è·å–å¹¶æ˜¾ç¤ºè¿™ä¸ªå±æ€§çš„å€¼ã€‚

web.xml:

```java
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://java.sun.com/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
         http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
         version="3.0">
   
    <context-param>
        <param-name>appName</param-name>
        <param-value>LearnServlet</param-value>
    </context-param>
    <context-param>
        <param-name>blogName</param-name>
        <param-value>https://blog.ulna520.top</param-value>
    </context-param>
</web-app>
```

```java
@WebServlet(name = "ContextTest",
            urlPatterns = {"/contextTest"}
)
public class ContextTest extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {
  
        ServletContext context = getServletContext();

        String appName = context.getInitParameter("appName");
        String blogName = context.getInitParameter("blogName");
        String contextPath = context.getContextPath();
        String ServletContextName = context.getServletContextName();  //æœªè®¾ç½®å¾—åˆ°null
  
        Map<String,Integer> map = new HashMap<>();
        map.put("appName", 1);
        map.put("blogName", 2);
        map.put("contextPath", 3);
        map.put("ServletContextName", 4);
        context.setAttribute("ServletContext", map);	//å¯ä»¥è®¾ç½®Objectå¯¹è±¡ï¼Œä»¥ä¾›å…¨å±€è®¿é—®ä¸€ä¸ªå¯¹è±¡

  
        resp.setContentType("text/html;charset=UTF-8");
        resp.getWriter().println("<html><body>");
        resp.getWriter().println("<h1>Context Parameters</h1>");
        resp.getWriter().println("<p>Application Name: " + appName + "</p>");
        resp.getWriter().println("<p>Blog Name: " + blogName + "</p>");
        resp.getWriter().println("<p>Context Path: " + contextPath + "</p>");
        resp.getWriter().println("<p>Servlet Context Name: " + ServletContextName + "</p>");
        resp.getWriter().println("<h2>Context Attributes</h2>");
        resp.getWriter().println("<ul>");
        Map<String, Integer> contextMap = (Map<String, Integer>) context.getAttribute("ServletContext");
        for (Map.Entry<String, Integer> entry : contextMap.entrySet()) {
            resp.getWriter().println("<li>" + entry.getKey() + ": " + entry.getValue() + "</li>");
        }
        resp.getWriter().println("</ul>");
        resp.getWriter().println("</body></html>");
    }

}

```

## Servlet è¯·æ±‚è½¬å‘ä¸é‡å®šå‘

### è¯·æ±‚è½¬å‘

è¯·æ±‚è½¬å‘æ˜¯æŒ‡å°†å½“å‰è¯·æ±‚çš„å¤„ç†äº¤ç»™webæœåŠ¡å™¨ä¸Šçš„å¦ä¸€ä¸ªèµ„æºæ¥å®Œæˆï¼Œè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨æœåŠ¡å™¨å†…éƒ¨ï¼Œå®¢æˆ·ç«¯**æµè§ˆå™¨åªå‘é€ä¸€æ¬¡è¯·æ±‚(**ä¸é‡å®šå‘çš„ä¸€ä¸ªå…³é”®ä¸åŒ**)**ã€‚

**å®ç°æ–¹å¼ï¼š**

é€šè¿‡ `RequestDispatcher` æ¥å£æ¥å®ç°è¯·æ±‚è½¬å‘ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ `HttpServletRequest `å¯¹è±¡çš„ `getRequestDispatcher(String path)` æ–¹æ³•è·å–ä¸€ä¸ª `RequestDispatcher`å¯¹è±¡ã€‚path å¯ä»¥æ˜¯ç›¸å¯¹äºå½“å‰**Servletä¸Šä¸‹æ–‡è·¯å¾„**ã€‚

`RequestDispatcher` æ¥å£æä¾›äº†ä¸¤ä¸ªä¸»è¦æ–¹æ³•ç”¨äºè½¬å‘ï¼š

* `forword(ServletRequest request, ServletResponse response)`ï¼šå°†è¯·æ±‚è½¬å‘ç»™å¦ä¸€ä¸ªèµ„æºã€‚
  * æ³¨æ„ï¼šåœ¨è½¬å‘åï¼Œ`forword()`åçš„ä»£ç æœ‰å¯èƒ½ä¼šæ‰§è¡Œã€‚ä½†æ˜¯åœ¨è°ƒç”¨ä¹‹åï¼Œå½“å‰Servlet**ä¸åº”è¯¥**å†å‘å®¢æˆ·ç«¯å‘é€ä»»ä½•å“åº”ã€‚æœ€ä½³å®è·µæ˜¯ `forwrod()`åå°±ç«‹å³ç»“æŸå½“å‰æ–¹æ³•ã€‚
* `include(ServletRequest request, ServletResponse response)`ï¼šå°†å¦ä¸€ä¸ªèµ„æºçš„å†…å®¹åŒ…å«åˆ°å½“å‰å“åº”ä¸­ã€‚æ‰§è¡Œæµç¨‹ä¼šå›åˆ°å½“å‰Servletç»§ç»­å¤„ç†ã€‚

```java
@WebServlet("/first")
public class FirstServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        request.setAttribute("message", "Hello from FirstServlet");
        RequestDispatcher dispatcher = request.getRequestDispatcher("/second");
        System.out.println("FirstServlet: Forwarding request to /second");
        dispatcher.forward(request, response);
        System.out.println("FirstServlet: After forwarding"); // è¿™è¡Œä»£ç å¯èƒ½ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œå–å†³äº SecondServlet çš„å¤„ç†
    }

    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        doGet(request, response);
    }
}
```

```java
@WebServlet("/second")
public class SecondServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String message = (String) request.getAttribute("message");
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter out = response.getWriter();
        out.println("<!DOCTYPE html>");
        out.println("<html><head><title>Second Servlet</title></head><body>");
        out.println("<h1>Second Servlet å¤„ç†è¯·æ±‚</h1>");
        if (message != null) {
            out.println("<p>Message from previous servlet: " + message + "</p>");
        } else {
            out.println("<p>No message passed.</p>");
        }
        out.println("</body></html>");
        System.out.println("SecondServlet: Request processed.");
    }

    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        doGet(request, response);
    }
}
```

### è¯·æ±‚é‡å®šå‘

è¯·æ±‚é‡å®šå‘æ˜¯æŒ‡æœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯æµè§ˆå™¨å‘é€ä¸€ä¸ªæ–°çš„HTTPè¯·æ±‚åˆ°å¦ä¸€ä¸ªURLã€‚è¿™æ¶‰åŠåˆ°ä¸¤æ¬¡HTTPè¯·æ±‚-å“åº”å‘¨æœŸã€‚

**å®ç°æ–¹å¼ï¼š**

é€šè¿‡ `HttpServletResponse` å¯¹è±¡çš„ `sendRedirect(String location)`æ–¹æ³•æ¥å‘é€é‡å®šå‘å“åº”ã€‚

`location` æ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨éœ€è¦é‡æ–°è®¿é—®çš„URLã€‚

```java
@WebServlet("/redirect-google")
public class RedirectServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        System.out.println("RedirectServlet: Received request, redirecting to Google.");
        response.sendRedirect("https://www.google.com");
        System.out.println("RedirectServlet: After sending redirect.");
    }

    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        doGet(request, response);
    }
}
```

# Filter

## FilteråŸºç¡€çŸ¥è¯†

Filter(è¿‡æ»¤å™¨)æ˜¯Servletè§„èŒƒä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç»„ä»¶ï¼Œå®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯åœ¨è¯·æ±‚åˆ°è¾¾ç›®æ ‡Servletæˆ–JSPä¹‹å‰ï¼Œä»¥åŠå“åº”ç¦»å¼€ç›®æ ‡Servlet/JSPåï¼Œå¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œæˆªè·å’Œå¤„ç†ã€‚

**Fliterçš„ä½œç”¨**ï¼š

åœ¨æ²¡æœ‰Filterä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œä¸€äº›é€šç”¨æ“ä½œ(æ¯”å¦‚æƒé™æ£€æŸ¥ã€ç¼–ç è®¾ç½®)ï¼Œæˆ‘ä»¬å°±åœ¨æ¯ä¸ªServletä¸­é‡å¤ç¼–å†™è¿™äº›é€»è¾‘ã€‚è¿™å›å¯¼è‡´å¤§é‡çš„é‡å¤ä»£ç ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚Filterçš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†è¿™äº›é€šç”¨çš„ã€ä¸å…·ä½“ä¸šåŠ¡é€»è¾‘æ— å…³çš„åŠŸèƒ½ä»Servletä¸­åˆ†ç¦»å‡ºæ¥ï¼Œé›†ä¸­å¤„ç†ã€‚

**åº”ç”¨åœºæ™¯**ï¼š

* **æƒé™è®¤è¯**ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ï¼Œæ˜¯å¦æœ‰æƒè®¿é—®æŸä¸ªèµ„æºã€‚
* **æ—¥å¿—è®°å½•**ï¼šè®°å½•æ¯ä¸ªè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚è¯·æ±‚è·¯å¾„ã€ç”¨æˆ·IPã€è¯·æ±‚æ—¶é—´ã€å“åº”è€—æ—¶ç­‰ã€‚
* **å­—ç¬¦ç¼–ç å¤„ç†**ï¼šç»Ÿä¸€è®¾ç½®è¯·æ±‚å’Œå“åº”çš„å­—ç¬¦ç¼–ç ï¼Œé˜²æ­¢ä¸­æ–‡ä¹±ç é—®é¢˜ã€‚
* **æ•°æ®å‹ç¼©**ï¼šå¯¹å“åº”å†…å®¹è¿›è¡ŒGZIPå‹ç¼©ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“é‡ï¼Œæé«˜åŠ è½½é€Ÿåº¦ã€‚
* **æ•æ„Ÿè¯è¿‡æ»¤**ï¼šå¯¹ç”¨æˆ·æäº¤çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œä¾‹å¦‚è¯„è®ºä¸­çš„æ•æ„Ÿè¯ã€‚
* **ç¼“å­˜æ§åˆ¶**ï¼šè®¾ç½®HTTPå“åº”å¤´ï¼Œæ§åˆ¶å®¢æˆ·ç«¯çš„ç¼“å­˜è¡Œä¸ºã€‚
* **ä¼šè¯ç®¡ç†**ï¼šæ£€æŸ¥ä¼šè¯æ˜¯å¦å­˜åœ¨ï¼Œæˆ–åœ¨ä¼šè¯è¿‡æœŸæ—¶é‡å®šå‘ã€‚

### Filterçš„ç”Ÿå‘½å‘¨æœŸ

Filterä¹Ÿæœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œç”±Servletå®¹å™¨å¦‚(Tomcat)ç®¡ç†ï¼š

1. **åŠ è½½å’Œå®ä¾‹åŒ–**ï¼šå½“Webåº”ç”¨ç¨‹åºå¯åŠ¨æˆ–è€…å®¹å™¨é¦–æ¬¡éœ€è¦ä½¿ç”¨æŸä¸ªFilteræ—¶ï¼Œå®¹å™¨ä¼šåŠ è½½å¹¶åˆ›å»ºFilterçš„å®ä¾‹ã€‚
2. **åˆå§‹åŒ–**(`init()`)ï¼šå®¹å™¨ä¼šè°ƒç”¨Filterå®ä¾‹çš„ `init()`æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œç”¨äºæ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚è¯»å–é…ç½®å‚æ•°ã€ç®€å†æ•°æ®åº“è¿æ¥ç­‰ã€‚

   æ–¹æ³•ç­¾åï¼š

   ```
   void init(FilterConfig filterConfig) throws ServletException
   ```
3. **è¯·æ±‚å¤„ç†**(`doFilter()`)ï¼šå½“å®¢æˆ·ç«¯è¯·åŒ¹é…åˆ°è¯¥Filteræ‹¦æˆªçš„URLæ¨¡å¼æ—¶ï¼Œå®¹å™¨å°±ä¼šè°ƒç”¨Filterå®ä¾‹çš„ `doFilter()`æ–¹æ³•ã€‚è¿™æ˜¯Filteræ‰§è¡Œæ ¸å¿ƒé€»è¾‘çš„åœ°æ–¹ã€‚
   æ–¹æ³•ç­¾åï¼š

   ```java
   void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException
   ```
4. **é”€æ¯**(`destroy()`)ï¼šå½“Webåº”ç”¨ç¨‹åºå…³é—­æˆ–è€…Filterè¢«å¸è½½æ—¶ï¼Œå®¹å™¨ä¼šè°ƒç”¨Filterå®ä¾‹çš„ `destroy()`æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¹Ÿåªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œç”¨äºé‡Šæ”¾èµ„æºï¼Œæ¯”å¦‚å…³é—­æ•°æ®åº“è¿æ¥ã€æ¸…ç†ç¼“å­˜ç­‰ã€‚

   æ–¹æ³•ç­¾åï¼š

   ```java
   void destroy()
   ```

### Filterä¸‰å¤§æ¥å£

#### `javax.servlet.Filter`æ¥å£

`javax.servlet.Filter` æ˜¯æ‰€æœ‰è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„åŸºçŸ³ã€‚å®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†Filterå¿…é¡»å®ç°çš„ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•ã€‚

* init()
* doFilter()
* destroy()

```java
package javax.servlet;

import java.io.IOException;

public interface Filter {
    /**
     * ç”± Web å®¹å™¨åœ¨ Filter å®ä¾‹åŒ–åç«‹å³è°ƒç”¨ï¼Œåªè°ƒç”¨ä¸€æ¬¡ã€‚
     * ç”¨äºæ‰§è¡Œåˆå§‹åŒ–ä»»åŠ¡ã€‚
     * @param filterConfig Filter çš„é…ç½®å¯¹è±¡
     * @throws ServletException å¦‚æœåˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯
     */
    void init(FilterConfig filterConfig) throws ServletException;

    /**
     * è¿™æ˜¯ Filter çš„æ ¸å¿ƒæ–¹æ³•ï¼Œæ¯å½“è¯·æ±‚åŒ¹é…åˆ° Filter æ˜ å°„çš„ URL æ¨¡å¼æ—¶éƒ½ä¼šè°ƒç”¨ã€‚
     * åœ¨è¿™é‡Œå¯ä»¥å¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œé¢„å¤„ç†æˆ–åå¤„ç†ã€‚
     * @param request Servlet è¯·æ±‚å¯¹è±¡
     * @param response Servlet å“åº”å¯¹è±¡
     * @param chain Filter é“¾ï¼Œç”¨äºå°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ª Filter æˆ–ç›®æ ‡èµ„æº
     * @throws IOException å¦‚æœå‘ç”Ÿ I/O é”™è¯¯
     * @throws ServletException å¦‚æœå‘ç”Ÿ Servlet é”™è¯¯
     */
    void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
        throws IOException, ServletException;

    /**
     * ç”± Web å®¹å™¨åœ¨ Filter å®ä¾‹è¢«é”€æ¯å‰è°ƒç”¨ï¼Œåªè°ƒç”¨ä¸€æ¬¡ã€‚
     * ç”¨äºé‡Šæ”¾ Filter æ‰€æŒæœ‰çš„èµ„æºã€‚
     */
    void destroy();
}
```

#### `javax.servlet.FilterChain` æ¥å£

FilterChain(è¿‡æ»¤å™¨é“¾)æ˜¯Filteræœºåˆ¶ä¸­ä¸€ä¸ªè‡³å…³é‡è¦çš„æ¦‚å¿µã€‚å½“ä¸€ä¸ªè¯·æ±‚è¿›å…¥ä¸€ä¸ªWebåº”ç”¨ç¨‹åºæ—¶ï¼Œå¦‚æœå®ƒéœ€è¦ç»è¿‡å¤šä¸ªFilterçš„å¤„ç†ï¼Œè¿™äº›Filterå°±ä¼šè¢«ç»„ç»‡æˆä¸€ä¸ªé“¾æ¡ã€‚FilterChain å°±æ˜¯è¿™ä¸ªé“¾æ¡çš„æŠ½è±¡ã€‚

`FilterChain` æ¥å£åªæœ‰ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š

```java
package javax.servlet;

import java.io.IOException;

public interface FilterChain {
    /**
     * å°†è¯·æ±‚å’Œå“åº”ä¼ é€’ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚
     * å¦‚æœè¿™æ˜¯é“¾ä¸­çš„æœ€åä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œåˆ™å°†è¯·æ±‚ä¼ é€’ç»™ç›®æ ‡èµ„æº (Servlet æˆ– JSP)ã€‚
     * @param request Servlet è¯·æ±‚å¯¹è±¡
     * @param response Servlet å“åº”å¯¹è±¡
     * @throws IOException å¦‚æœå‘ç”Ÿ I/O é”™è¯¯
     * @throws ServletException å¦‚æœå‘ç”Ÿ Servlet é”™è¯¯
     */
    void doFilter(ServletRequest request, ServletResponse response)
        throws IOException, ServletException;
}
```

åœ¨è‡ªå®šä¹‰Filterçš„doFilter()æ–¹æ³•ä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨åˆ° `chain.doFilter(request,response)`

ä½œç”¨ï¼š

* å¦‚æœå½“å‰Filterä¸æ˜¯é“¾ä¸­çš„æœ€åä¸€ä¸ªFilterï¼Œå®ƒä¼šå°†è¯·æ±‚å’Œå“åº”å¯¹è±¡ä¼ é€’ç»™ä¸‹ä¸€ä¸ªFilterã€‚
* å¦‚æœå½“å‰Filteræ˜¯é“¾ä¸­çš„æœ€åä¸€ä¸ªFilterï¼Œå®ƒä¼šå°†è¯·æ±‚å’Œå“åº”å¯¹è±¡ä¼ é€’ç»™æœ€ç»ˆçš„ç›®æ ‡èµ„æº(ä¾‹å¦‚Servletæˆ–JSP)

å¦‚æœæ²¡ç”¨è°ƒç”¨ `chain.doFilter(request, response)`ï¼Œé‚£ä¹ˆè¯·æ±‚å°±ä¸ä¼šç»§ç»­ä¼ é€’ä¸‹å»ï¼Œå®ƒå°†è¢«ä¸­æ–­ï¼Œåç»­çš„Filteræˆ–ç›®æ ‡èµ„æºå°†æ°¸è¿œä¸ä¼šæ‰§è¡Œåˆ°ã€‚

#### `javax.servlet.FilterConfig` æ¥å£

`FilterConfig `å¯¹è±¡æä¾›äº†Filterçš„é…ç½®ä¿¡æ¯ã€‚å½“å®¹å™¨è°ƒç”¨Filterçš„ `init()`æ–¹æ³•æ—¶ï¼Œä¼šå°†ä¸€ä¸ª `FilterConfig`å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’è¿›æ¥ã€‚

`FilterConfig`æ¥å£æä¾›çš„æ–¹æ³•åŒ…æ‹¬ï¼š

* `String getFilterName()`ï¼šè·å–Filterçš„åç§°(åœ¨web.xmlä¸­ `<filter-name>`å®šä¹‰çš„åç§°ï¼Œæˆ–è€… `@WebFilter`æ³¨è§£çš„ `filterName`å±æ€§)
* `ServletContext getServletContext()`ï¼šè·å–ä¸æ­¤Filterç›¸å…³çš„ `ServletContext` å¯¹è±¡ã€‚
* `String getInitparameter(String name)`ï¼šæ ¹æ®å‚æ•°åè·å–Filterçš„åˆå§‹åŒ–å‚æ•°å€¼ã€‚(åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„å‚æ•°)
* `Enumeration<String> getInitParameterNames()`ï¼šè·å–æ‰€æœ‰åˆå§‹åŒ–å‚æ•°çš„åç§°ã€‚

## åˆ›å»ºä¸é…ç½®Filter

### åˆ›å»ºFilter

åˆ›å»ºFilterä¸»è¦æ¶‰åŠä¸¤æ­¥ï¼š

* å®ç° `javax.servlet.Filter`æ¥å£
* é‡å†™å…¶æ ¸å¿ƒæ–¹æ³•ã€‚

æ­¥éª¤ä¸€ï¼šåˆ›å»ºä¸€ä¸ªJavaç±»å¹¶å®ç°Filteræ¥å£

æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ™®é€šçš„Javaç±»ï¼Œå¹¶è®©å®ƒå®ç° `javax.servlet.Filter`æ¥å£ã€‚

```java
package com.example.filters;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import java.io.IOException;


public class MyCustomFilter implements Filter{

    private String filterName; // å­˜å‚¨ Filter çš„åç§°

    /**
     * Filter åˆå§‹åŒ–æ–¹æ³•ï¼Œåœ¨ Filter å®ä¾‹åˆ›å»ºåè¢« Web å®¹å™¨è°ƒç”¨ä¸€æ¬¡ã€‚
     * å¯ä»¥åœ¨è¿™é‡Œè¯»å–åˆå§‹åŒ–å‚æ•°ï¼Œè¿›è¡Œä¸€äº›èµ„æºå‡†å¤‡ã€‚
     * @param filterConfig åŒ…å« Filter é…ç½®ä¿¡æ¯çš„å¯¹è±¡
     * @throws ServletException å¦‚æœåˆå§‹åŒ–å¤±è´¥
     */
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        this.filterName = filterConfig.getFilterName();
        System.out.println(filterName + " åˆå§‹åŒ–...");
        // ç¤ºä¾‹ï¼šè·å– Filter çš„åˆå§‹åŒ–å‚æ•°
        String paramValue = filterConfig.getInitParameter("myParam");
        if (paramValue != null) {
            System.out.println("è·å–åˆ°åˆå§‹åŒ–å‚æ•° 'myParam': " + paramValue);
        }
    }

    /**
     * æ ¸å¿ƒæ–¹æ³•ï¼Œæ¯æ¬¡è¯·æ±‚åŒ¹é…åˆ°è¯¥ Filter æ—¶éƒ½ä¼šè¢«è°ƒç”¨ã€‚
     * åœ¨è¿™é‡Œå®ç°ä½ çš„è¿‡æ»¤é€»è¾‘ã€‚
     * @param request ServletRequest å¯¹è±¡
     * @param response ServletResponse å¯¹è±¡
     * @param chain FilterChain å¯¹è±¡ï¼Œç”¨äºå°†è¯·æ±‚ä¼ é€’  ç»™ä¸‹ä¸€ä¸ª Filter æˆ–ç›®æ ‡èµ„æº
     * @throws IOException å¦‚æœå‘ç”Ÿ I/O é”™è¯¯
     * @throws ServletException å¦‚æœå‘ç”Ÿ Servlet é”™è¯¯
     */
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        System.out.println(filterName + " æ­£åœ¨æ‰§è¡Œ doFilter() (è¯·æ±‚è¿›å…¥å‰)");


        // ç»§ç»­å°†è¯·æ±‚ä¼ é€’ç»™ Filter é“¾ä¸­çš„ä¸‹ä¸€ä¸ª Filter æˆ–ç›®æ ‡èµ„æº
        chain.doFilter(request, response);

        // åå¤„ç†ï¼Œåœ¨è¯·æ±‚å¤„ç†å®Œæ¯•ã€å“åº”è¿”å›å‰è¢«æ‰§è¡Œ
        System.out.println(filterName + " æ­£åœ¨æ‰§è¡Œ doFilter() (è¯·æ±‚ç¦»å¼€å)");
    }

    /**
     * Filter é”€æ¯æ–¹æ³•ï¼Œåœ¨ Filter å®ä¾‹è¢«é”€æ¯å‰è¢« Web å®¹å™¨è°ƒç”¨ä¸€æ¬¡ã€‚
     * å¯ä»¥åœ¨è¿™é‡Œé‡Šæ”¾èµ„æºã€‚
     */
    @Override
    public void destroy() {
        System.out.println(filterName + " æ­£åœ¨é”€æ¯...");
        // ç¤ºä¾‹ï¼šå…³é—­æ•°æ®åº“è¿æ¥ã€æ¸…ç†èµ„æºç­‰
    }
}

```

### é…ç½®Filter

#### åœ¨ `web.xml`ä¸­é…ç½®Filter(ä¼ ç»Ÿæ–¹å¼)

è¿™æ˜¯Servlet 2.X å’Œæ—©æœŸç‰ˆæœ¬çš„ä¸»è¦é…ç½®æ–¹å¼ï¼Œåœ¨Servlet 3.0+ä¸­ä¾ç„¶å®Œå…¨æœ‰æ•ˆï¼Œå¹¶ä¸”åœ¨éœ€è¦ç²¾å‡†æ§åˆ¶Filteré¡ºåºæ—¶éå¸¸æœ‰æ•ˆã€‚

1. **æ‰“å¼€æˆ–åˆ›å»º `web.xml`æ–‡ä»¶**
   é€šå¸¸ä½äºä½ çš„Webé¡¹ç›®çš„WEB-INF/web.xmlè·¯å¾„ä¸‹ã€‚
2. **å£°æ˜Filter**
   ä½¿ç”¨ `<filter>`æ ‡ç­¾åœ¨web.xmlä¸­å£°æ˜ä½ çš„Filterã€‚

   * `<filter-name>`ï¼šä¸ºä½ çš„Filterå®šä¹‰ä¸€ä¸ªå”¯ä¸€çš„åç§°ã€‚
   * `<filter-class>`ï¼šæŒ‡å®šä½ çš„Filterç±»çš„å®Œå…¨é™å®šåã€‚
   * `<init-param>`(å¯é€‰)ï¼šä¸ºFilteræä¾›åˆå§‹åŒ–å‚æ•°ï¼Œè¿™äº›å‚æ•°å¯ä»¥åœ¨ `init()`æ–¹æ³•ä¸­é€šè¿‡ `FilterConfig`è·å–ã€‚

   ```xml
   <filter>
       <filter-name>MyFilter</filter-name>
       <filter-class>com.example.filters.MyCustomFilter</filter-class>
       <init-param>
           <param-name>myParam</param-name>
           <param-value>HelloFilter</param-value>
       </init-param>
       <init-param>
           <param-name>anotherParam</param-name>
           <param-value>123</param-value>
       </init-param>
   </filter>
   ```
3. **æ˜ å°„Filteråˆ°URLæ¨¡å¼**ï¼š

   ä½¿ç”¨ `<filter-mapping>`æ ‡ç­¾å°†å£°æ˜çš„Filteræ˜ å°„åˆ°ç‰¹å®šçš„URLæ¨¡å¼ã€‚åªæœ‰åŒ¹é…è¿™äº›æ¨¡å¼çš„è¯·æ±‚æ‰ä¼šç»è¿‡æ­¤Filterã€‚

   * `<filter-name>` ï¼š
   * `<url-pattern>`ï¼š
     * `/*`ï¼šæ‹¦æˆªæ‰€æœ‰çš„è¯·æ±‚
     * `/user/*`ï¼šæ‹¦æˆªæ‰€æœ‰ä»¥ `/user/`å¼€å¤´çš„è¯·æ±‚
     * `*.jsp`ï¼šæ‹¦æˆªæ‰€æœ‰.jspç»“å°¾çš„è¯·æ±‚
     * `/specific/path`ï¼šæ‹¦æˆªç²¾ç¡®åŒ¹é…çš„è·¯å¾„
   * `<dispatcher>`(å¯é€‰)ï¼šæŒ‡å®šFilteråº”è¯¥åœ¨å“ªç§è¯·æ±‚è°ƒåº¦ç±»å‹ä¸‹è¢«ä½¿ç”¨ã€‚å¸¸è§çš„æœ‰ï¼š
     * `REQUEST`(é»˜è®¤)ï¼šå½“å®¢æˆ·ç«¯ç›´æ¥è¯·æ±‚èµ„æºæ—¶ã€‚
     * `FORWARD`ï¼šå½“é€šè¿‡ `RequestDispatcher.forward()`è½¬å‘æ—¶ã€‚
     * `INCLUDE`ï¼šå½“é€šè¿‡ `RequestDispatcher.include()`åŒ…å«æ—¶ã€‚
     * `ERROR`ï¼šå½“è¯·æ±‚å› ä¸ºé”™è¯¯è€Œè½¬å‘åˆ°**é”™è¯¯é¡µé¢**æ—¶ã€‚
     * `ASYNC`ï¼šå½“è¯·æ±‚é€šè¿‡å¼‚æ­¥ä¸Šä¸‹æ–‡å¤„ç†æ—¶(Servlet3.0+)

   ```xml
   <filter-mapping>
       <filter-name>MyFilter</filter-name>
       <url-pattern>/*</url-pattern>  
       <dispatcher>REQUEST</dispatcher>
       <dispatcher>FORWARD</dispatcher>
   </filter-mapping>
   ```

   > åœ¨ `web.xml`ä¸­ï¼ŒFilterçš„æ‰§è¡Œé¡ºåºæ˜¯æ ¹æ®å®ƒä»¬åœ¨ `<web-app>`æ ‡ç­¾å†… `<filter-mapping>`å…ƒç´ çš„å‡ºç°é¡ºåºæ¥å†³å®šçš„ã€‚å®¹å™¨ä¼šæŒ‰ç…§web.xmlæ–‡ä»¶ä¸­ `<filter-mapping>`å£°æ˜çš„ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºæ¥æ„å»ºFilteré“¾å¹¶ä¾æ¬¡æ‰§è¡Œã€‚å¦‚æœæ˜¯urlä¸åŒ¹é…çš„Filterï¼Œåˆ™è·³è¿‡ã€‚ä¸€ç›´æ‰§è¡Œåˆ°æœ€ç»ˆèµ„æºã€‚
   >

#### ä½¿ç”¨æ³¨è§£ `@WebFilteré…ç½®Filter(Servlet3.0+)`

ä»Servlet3.0 å¼€å§‹ï¼Œä½ å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥ç®€åŒ–Filterçš„é…ç½®ï¼Œçœå»äº†ç¼–å†™web.xmlçš„éº»çƒ¦ã€‚

åœ¨Filterç±»ä¸Šæ·»åŠ  `@WebFilter`æ³¨è§£

* `filterName`(å¯é€‰)ï¼šæŒ‡å®šFilterçš„åç§°ï¼Œé»˜è®¤ä¸ºç±»åã€‚
* `urlPatterns`ï¼šä¸€ä¸ªå­—ç¬¦ä¸²**æ•°ç»„**(å¯ä»¥æ‹¦æˆªå¤šä¸ªè·¯å¾„)ï¼Œç”¨äºæŒ‡å®šFilterå°†æ‹¦æˆªçš„URLæ¨¡å¼
* `value`ï¼š`urlPatterns`çš„åˆ«åã€‚å¦‚æœåªæœ‰ä¸€ä¸ªURLæ¨¡å¼ï¼Œå¯ä»¥ç›´æ¥ç”¨valueã€‚
* `initParams`(å¯é€‰)ï¼šä¸€ä¸ª `@WebInitParam`**æ•°ç»„**ï¼Œç”¨äºè®¾ç½®åˆå§‹åŒ–å‚æ•°ã€‚
* `dispatcherTypes`(å¯é€‰)ï¼šä¸€ä¸ªDispatcherTypeæ•°ç»„ï¼ŒæŒ‡å®šFilteråº”è¯¥åœ¨å“ªç§è¯·æ±‚è°ƒåº¦ç±»å‹ä¸‹è¢«è°ƒç”¨ã€‚

```java
package com.example.filters;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebFilter;
import javax.servlet.annotation.WebInitParam;
import javax.servlet.DispatcherType; // å¯¼å…¥ DispatcherType
import java.io.IOException;

// ä½¿ç”¨æ³¨è§£é…ç½® Filter
@WebFilter(
    filterName = "AnnotatedMyFilter", // Filter çš„åç§°
    urlPatterns = {"/*"}, // æ‹¦æˆªæ‰€æœ‰è¯·æ±‚
    initParams = { // åˆå§‹åŒ–å‚æ•°
        @WebInitParam(name = "myParam", value = "HelloAnnotatedFilter")
    },
    dispatcherTypes = {DispatcherType.REQUEST, DispatcherType.FORWARD} // è°ƒåº¦ç±»å‹
)
public class MyCustomFilter implements Filter {
    // ... (ä¸ä¸Šé¢ web.xml æ–¹å¼çš„ Filter ç±»å†…å®¹ç›¸åŒ) ...
    private String filterName;

    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        this.filterName = filterConfig.getFilterName();
        System.out.println(filterName + " åˆå§‹åŒ–...");
        String paramValue = filterConfig.getInitParameter("myParam");
        if (paramValue != null) {
            System.out.println("è·å–åˆ°åˆå§‹åŒ–å‚æ•° 'myParam': " + paramValue);
        }
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        System.out.println(filterName + " æ­£åœ¨æ‰§è¡Œ doFilter() (è¯·æ±‚è¿›å…¥å‰)");
        chain.doFilter(request, response);
        System.out.println(filterName + " æ­£åœ¨æ‰§è¡Œ doFilter() (è¯·æ±‚ç¦»å¼€å)");
    }

    @Override
    public void destroy() {
        System.out.println(filterName + " æ­£åœ¨é”€æ¯...");
    }
}
```

> Filteré¡ºåºï¼šå¦‚å‰æ‰€è¿°ï¼Œåœ¨ä½¿ç”¨ `@WebFilter`æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹Filterçš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ä¿è¯çš„(é€šå¸¸æŒ‰ç…§filterNameçš„å­—æ¯é¡ºåºæˆ–è€…ç±»åŠ è½½é¡ºåº)ï¼Œå¦‚æœä½ éœ€è¦ç²¾ç¡®çš„æ§åˆ¶é¡ºåºï¼Œå»ºè®®ä½¿ç”¨web.xmlé…ç½®ï¼Œæˆ–è€…åœ¨Springç­‰æ¡†æ¶ä¸­ä½¿ç”¨ `@Order` æ³¨è§£

# Listener

åœ¨Java Servletä¸­ï¼Œ**Listener**(ç›‘å¬å™¨)æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç»„ä»¶ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯"ç›‘å¬"Webåº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„ç‰¹å®šäº‹ä»¶ã€‚å½“æŸä¸ªé¢„è®¾äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒListenerå°±ä¼šè¢«è§¦å‘ï¼Œç„¶åæ‰§è¡Œä½ ä¸ºå®ƒå®šä¹‰çš„ç‰¹å®šæ“ä½œã€‚

è¿™äº›äº‹ä»¶å¯ä»¥æ˜¯ï¼š

* Webåº”ç”¨ç¨‹åºè‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
* ç”¨æˆ·ä¼šè¯(Session)çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
* HTTPè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
* ç‰¹å®šä½œç”¨åŸŸ(åº”ç”¨ç¨‹åºã€ä¼šè¯ã€è¯·æ±‚)ä¸­å±æ€§çš„æ·»åŠ ã€ç§»é™¤æˆ–æ›¿æ¢äº‹ä»¶ã€‚

Listenerçš„æ ¸å¿ƒä½œç”¨ï¼š

Listenerçš„å­˜åœ¨ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿåœ¨è¿™äº›å…³é”®æ—¶åˆ»**ä»‹å…¥å¹¶æ‰§è¡Œè‡ªå®šä¹‰çš„é€»è¾‘**ï¼Œè€Œæ— éœ€ä¿®æ”¹Servletæˆ–JSPé¡µé¢çš„æ ¸å¿ƒä¸šåŠ¡ä»£ç ã€‚å®ƒçš„ä¸»è¦ä½œç”¨ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. èµ„æºåˆå§‹åŒ–ä¸æ¸…ç†ï¼š
   * **ä½œç”¨**ï¼šåœ¨Web**åº”ç”¨ç¨‹åº**å¯åŠ¨æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨Listeneræ¥åŠ è½½é…ç½®æ–‡ä»¶ã€åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± ã€å¯åŠ¨åå°æœåŠ¡ç­‰ä¸€æ¬¡æ€§è®¾ç½®ã€‚è€Œåœ¨åº”ç”¨ç¨‹åºå…³é—­æ—¶ï¼Œå®ƒå¯ä»¥ç”¨æ¥å…³é—­è¿æ¥ã€é‡Šæ”¾èµ„æºã€ç¡®ä¿ç³»ç»Ÿå¹²å‡€çš„é€€å‡ºã€‚
   * **èŒè´£åˆ†ç¦»**ï¼šServletæˆ–Filterçš„init()æ–¹æ³•åªåœ¨ç‰¹å®šServletè¢«åˆå§‹åŒ–æ—¶ï¼Œè¿™äº›èµ„æºæ‰ä¼šè¢«åˆå§‹åŒ–ã€‚å¦‚æœæˆ‘æœ‰å¤šä¸ªServletéƒ½éœ€è¦è¿™äº›èµ„æºï¼Œé‚£ä¹ˆæ¯ä¸ªServletéƒ½éœ€è¦é‡å¤åˆå§‹åŒ–é€»è¾‘ï¼ŒFilteråŒç†ã€‚Listenerä¸“æ³¨äºåº”ç”¨ç¨‹åºçº§åˆ«çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œå…¨å±€èµ„æºçš„åˆå§‹åŒ–/æ¸…ç†ã€‚å®ƒçš„ä»£ç æ›´æ¸…æ™°ï¼Œä¸“é—¨å¤„ç†â€œå½“åº”ç”¨ç¨‹åºå¯åŠ¨/å…³é—­æ—¶ï¼Œæˆ‘éœ€è¦åšä»€ä¹ˆâ€çš„é—®é¢˜ã€‚
2. æ•°æ®ç»Ÿè®¡ä¸ç›‘æ§ï¼š
   * **ä½œç”¨**ï¼šListenerå¯ä»¥ç”¨æ¥å®æ—¶è·Ÿè¸ªç½‘ç«™çš„ä½¿ç”¨æƒ…å†µã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è®¡ç®—å½“å‰åœ¨çº¿ç”¨æˆ·æ•°é‡ï¼Œè®°å½•æ¯å¤©çš„è®¿é—®é‡ï¼Œæˆ–è€…ç›‘æ§æŸä¸ªç‰¹å®šåŠŸèƒ½çš„ä½¿ç”¨é¢‘ç‡ã€‚
   * **ä¾‹å­**ï¼šä½ æƒ³çŸ¥é“æœ‰å¤šå°‘ç”¨æˆ·åŒæ—¶åœ¨çº¿ã€‚ä½ å¯ä»¥ä½¿ç”¨Listenerç›‘å¬ä¼šè¯çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ï¼Œæ¯æ¬¡åˆ›å»ºå°±+1ï¼Œé”€æ¯å°±-1ï¼Œä»è€Œå¾—åˆ°åœ¨çº¿ç”¨æˆ·æ•°é‡ã€‚
3. æ—¥å¿—è®°å½•ï¼š
   * **ä½œç”¨**ï¼šåœ¨åº”ç”¨ç¨‹åºã€ä¼šè¯æˆ–è¯·æ±‚çš„å…³é”®ç”Ÿå‘½å‘¨æœŸç‚¹è®°å½•æ—¥å¿—ï¼Œå¸®åŠ©å¼€å‘è€…è¿½è¸ªåº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€è¯Šæ–­é—®é¢˜æˆ–è¿›è¡Œæ€§èƒ½åˆ†æã€‚
   * **ä¾‹å­**ï¼šæ¯å½“ä¸€ä¸ªç”¨æˆ·è¯·æ±‚è¿›å…¥æˆ–ç¦»å¼€æœåŠ¡æ—¶ï¼Œä½ æƒ³è®°å½•ä¸‹è¯·æ±‚çš„URLå’Œå¤„ç†æ—¶é—´ã€‚Listenerå°±å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚

## Liteneræ¥å£

Java Servlet è§„èŒƒæä¾›äº†ä¸€ç³»åˆ—Listeneræ¥å£ï¼Œå®ƒä»¬è¢«è®¾è®¡ç”¨æ¥ç›‘å¬ä¸åŒèŒƒå›´å’Œç±»å‹çš„äº‹ä»¶ã€‚æŒæ¡è¿™äº›æ¥å£æ˜¯ä½¿ç”¨Listenerçš„åŸºç¡€ã€‚

### åº”ç”¨(Webå®¹å™¨)ç”Ÿå‘½å‘¨æœŸListener

è¿™ç±»Listenerç”¨äºç›‘å¬æ•´ä¸ªWebåº”ç”¨ç¨‹åºçš„å¯åŠ¨å’Œå…³é—­äº‹ä»¶ã€‚

`ServletContextListener`ï¼š

* **ä½œç”¨**ï¼šç›‘å¬Webåº”ç”¨ç¨‹åº(ServletContext)çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚å½“æ•´ä¸ªWebåº”ç”¨ç¨‹åºè¢«éƒ¨ç½²åˆ°Servletå®¹å™¨(å¦‚Tomcat)å¹¶å¯åŠ¨æ—¶ï¼Œä»¥åŠå½“åº”ç”¨ç¨‹åºè¢«å…³é—­æˆ–å¸è½½æ—¶ï¼Œå®ƒå°±ä¼šæ”¶åˆ°é€šçŸ¥ã€‚
* **æ¥å£æ–¹æ³•**ï¼š
  * `void contextInitialized(ServletContextEvent sce)`ï¼šå½“Webåº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæ­¤æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œå…¨å±€æ€§åˆå§‹åŒ–å·¥ä½œã€‚ä¾‹å¦‚ï¼š
    * åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± 
    * åŠ è½½åº”ç”¨ç¨‹åºçš„å…¨å±€é…ç½®å‚æ•°
    * å¯åŠ¨åå°æœåŠ¡æˆ–å®šæ—¶ä»»åŠ¡
    * åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
  * `void contextDestroyed(ServletContextEvent sce)`ï¼šå½“Webåº”ç”¨ç¨‹åºå…³é—­æˆ–è¢«å¸è½½æ—¶ï¼Œæ­¤æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œèµ„æºæ¸…ç†å·¥ä½œï¼Œä¾‹å¦‚ï¼š
    * å…³é—­æ•°æ®åº“è¿æ¥æ± 
    * é‡Šæ”¾å ç”¨çš„å†…å­˜æˆ–æ–‡ä»¶å¥æŸ„
    * åœæ­¢åå°æœåŠ¡
* **ä½¿ç”¨åœºæ™¯**ï¼šè¿™æ˜¯æœ€å¸¸ç”¨çš„Listenerä¹‹ä¸€ï¼Œé€‚ç”¨äºé‚£äº›éœ€è¦åœ¨åº”ç”¨ç¨‹åºçº§åˆ«è¿›è¡Œä¸€æ¬¡æ€§è®¾ç½®å’Œæ¸…ç†çš„ä»»åŠ¡ã€‚

### ä¼šè¯(Session)ç”Ÿå‘½å‘¨æœŸListener

è¿™ç±»Listenerç”¨äºç›‘å¬ç”¨æˆ·ä¼šè¯çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶ã€‚

`HttpSessionListener`ï¼š

* **ä½œç”¨**ï¼šç›‘å¬HTTPä¼šè¯(HttpSession)çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™å¹¶åˆ›å»ºä¼šè¯æ—¶ï¼Œä»¥åŠå½“ä¼šè¯è¿‡æœŸæˆ–è¢«æ˜ç¡®é”€æ¯æ—¶ï¼Œå®ƒå°±æ”¶åˆ°é€šçŸ¥ã€‚
* **æ¥å£æ–¹æ³•**ï¼š
  * `void sessionCreated(HttpSessionEvent se)`ï¼šå½“æ–°çš„Httpä¼šè¯è¢«åˆ›å»ºæ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªäº‹ä»¶ï¼š
    * ç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°é‡
    * ä¸ºæ–°ä¼šè¯è®¾ç½®é»˜è®¤å±æ€§
  * `void sessionDestroyed(HttpSessionEvent se)`ï¼šå½“HTTPä¼šè¯å¤±æ•ˆ(è¿‡æœŸæˆ–è¢«æ˜¾ç¤ºè°ƒç”¨ `invalidate()`)æ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªäº‹ä»¶æ¥ï¼š
    * ç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°
    * æ¸…ç†ä¸è¯¥ä¼šè¯ç›¸å…³çš„èµ„æº

### è¯·æ±‚ç”Ÿå‘½å‘¨æœŸListener

è¿™ç±»Listenerç”¨äºç›‘å¬æ¯ä¸ªHTTPè¯·æ±‚çš„å¼€å§‹å’Œç»“æŸäº‹ä»¶ã€‚

`ServletRequestListener`ï¼š

* **ä½œç”¨**ï¼šç›‘å¬HTTPè¯·æ±‚(ServletRequest)çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚åœ¨æ¯ä¸ªHTTPè¯·æ±‚è¢«Webå®¹å™¨æ¥æ”¶å¹¶å¼€å§‹å¤„ç†æ—¶ï¼Œä»¥åŠåœ¨è¯·æ±‚å¤„ç†å®Œæ¯•å³å°†å‘é€å“åº”å›å®¢æˆ·ç«¯æ—¶ï¼Œå®ƒéƒ½ä¼šæ”¶åˆ°é€šçŸ¥ã€‚
* **æ¥å£æ–¹æ³•**ï¼š
  * `void requestInitialized(ServletRequestEvent sre)`ï¼šå½“æ¯ä¸ªHTTPè¯·æ±‚å¼€å§‹è¢«å¤„ç†æ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œï¼š
    * è®°å½•è¯·æ±‚çš„å¼€å§‹æ—¶é—´ï¼Œç”¨äºæ€§èƒ½åˆ†æã€‚
    * åˆå§‹åŒ–ä¸å½“å‰è¯·æ±‚ç›¸å…³çš„ç‰¹å®šèµ„æºã€‚
  * `void requestDestroyed(ServletRequestEvent sre)`ï¼šå½“æ¯ä¸ªHTTPè¯·æ±‚å¤„ç†å®Œæˆå¹¶å³å°†å“åº”ç»™å®¢æˆ·ç«¯æ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œï¼š
    * è®°å½•è¯·æ±‚çš„ç»“æŸæ—¶é—´å¹¶è®¡ç®—å¤„ç†è€—æ—¶
    * æ¸…ç†ä¸å½“å‰è¯·æ±‚ç›¸å…³çš„ä¸´æ—¶èµ„æº
* **ä½¿ç”¨åœºæ™¯**ï¼šå¸¸ç”¨äºè¯·æ±‚çº§åˆ«çš„æ€§èƒ½ç›‘æ§ï¼Œæ—¥å¿—è®°å½•ç­‰ã€‚

### å±æ€§å˜æ›´Listener

è¿™ç±»Listenerç”¨äºç›‘å¬ç‰¹å®šä½œç”¨åŸŸ(`ServletContext`ã€`HttpSession`ã€`ServletRequest`)ä¸­å±æ€§çš„æ·»åŠ ã€ç§»é™¤ã€æ›¿æ¢äº‹ä»¶ã€‚å½“è°ƒç”¨setAttribute()ã€removeAttribute()æˆ–replaceAttribute()æ–¹æ³•æ—¶ï¼Œè¿™äº›Listenerå°±ä¼šè¢«è§¦å‘ã€‚

`ServletContextAttributeListener`ï¼š

* **ä½œç”¨**ï¼šç›‘å¬ServletContext(åº”ç”¨ç¨‹åºä½œç”¨åŸŸ)ä¸­å±æ€§çš„å˜åŒ–ã€‚
* **æ¥å£æ–¹æ³•**ï¼š
  * `attributeAdded(ServletContextAttributeEvent scae)`
  * `attributeRemoved(ServletContextAttributeEvent scae)`
  * `attributeReplaced(ServletContextAttributeEvent scae)`

`HttpSessionAttributeListener`ï¼š

* **ä½œç”¨**ï¼šç›‘å¬HttpSession(ä¼šè¯ä½œç”¨åŸŸ)ä¸­å±æ€§çš„å˜åŒ–
* **æ¥å£æ–¹æ³•**ï¼š
  * `attributeAdded(HttpSessionBindingEvent hsbe)`
  * `attributeRemoved(HttpSessionBindingEvent hsbe)`
  * `attributeReplaced(HttpSessionBindingEvent hsbe)`

`ServletRequestAttributeListener`ï¼š

* **ä½œç”¨**ï¼šç›‘å¬ServletRequest(è¯·æ±‚ä½œç”¨åŸŸ)ä¸­å±æ€§çš„å˜åŒ–
* **æ¥å£æ–¹æ³•**ï¼š
  * `attributeAdded(ServletRequestAttributeEvent srae)`
  * `attributeRemoved(ServletRequestAttributeEvent srae)`
  * `attributeReplaced(ServletRequestAttributeEvent srae)`

ä½¿ç”¨åœºæ™¯ï¼šç”¨äºç›‘æ§å’Œå“åº”ç‰¹å®šä½œç”¨åŸŸå†…æ•°æ®çš„åŠ¨æ€å˜åŒ–ï¼Œä¾‹å¦‚ï¼š

* å½“æŸä¸ªå…³é”®é…ç½®å±æ€§åœ¨åº”ç”¨ç¨‹åºçº§åˆ«è¢«ä¿®æ”¹æ—¶ï¼Œè§¦å‘é‡æ–°åŠ è½½
* è·Ÿè¸ªä¼šè¯ä¸­ç”¨æˆ·ç™»å½•çŠ¶æ€çš„å˜åŒ–
* è¯·æ±‚å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®å±æ€§å˜åŒ–æ‰§è¡Œç‰¹å®šé€»è¾‘

### ä¼šè¯ç»‘å®šListener

è¿™ç±»Listenerä¸“æ³¨äºç›‘å¬Javaå¯¹è±¡ä½•æ—¶è¢«ç»‘å®šåˆ° `HttpSession`æˆ–ä» `HttpSession`ä¸­è§£é™¤ç»‘å®šã€‚

`HttpSessionBindingListener`ï¼š

* **ä½œç”¨**ï¼šè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Listenerï¼Œå®ƒä¸æ˜¯ç”±å®¹å™¨æ³¨å†Œçš„ã€‚è€Œæ˜¯è¢«ç»‘å®šåˆ°Sessionçš„**Javaå¯¹è±¡æœ¬èº«å®ç°**ã€‚å½“ä¸€ä¸ªå®ç°äº†æ­¤æ¥å£çš„å¯¹è±¡è¢«HttpSession.setAttribute()å­˜å‚¨åˆ°Sessionä¸­æ—¶ï¼Œå…¶valueBound()æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼›å½“å®ƒè¢«HttpSession.removeAttribute()æˆ–Sessionå¤±æ•ˆæ—¶ï¼Œå…¶valueUnbound()æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚
* **æ¥å£æ–¹æ³•**ï¼š
  * `void valueBound(HttpSessionBindingEvent event)`
  * `void valueUnbound(HttpSessionBindingEvent event)`
* **ä½¿ç”¨åœºæ™¯**ï¼šå½“æŸä¸ªå¯¹è±¡éœ€è¦çŸ¥é“å®ƒä½•æ—¶è¢«æ”¾å…¥æˆ–ç§»é™¤Sessionæ—¶éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ï¼š
  * ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ï¼Œå½“å®ƒè¢«ç»‘å®šåˆ°Sessionæ—¶ï¼Œå¯ä»¥æ›´æ–°æ•°æ®åº“ä¸­çš„åœ¨çº¿çŠ¶æ€ã€‚
  * ä¸€ä¸ªèµ„æºå¥æŸ„ï¼Œå½“å®ƒè¢«ä»Sessionç§»é™¤æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨é‡Šæ”¾èµ„æºã€‚

> Listenerä¸åŸæ¥æ‰§è¡Œä»£ç çš„æ‰§è¡Œé¡ºåº
>
> å½“Listenerè¢«è§¦å‘æ—¶ï¼Œå®ƒä¸åŸæ¥çš„ä»£ç ä¹‹é—´ï¼Œé€šå¸¸æ˜¯é¡ºåºæ‰§è¡Œçš„å…³ç³»ï¼Œè€Œä¸æ˜¯å¹¶è¡Œæ‰§è¡Œã€‚
>
> 1. **è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ**ï¼šè¯·æ±‚å¼€å§‹(è°ƒç”¨Listener)->è¿›å…¥Filteré“¾->è¿›å…¥Servlet->ç¦»å¼€Servlet->ç¦»å¼€Filter->è¯·æ±‚ç»“æŸ(è°ƒç”¨Listener)
> 2. **å±æ€§å˜æ›´**ï¼š`setAttribute()`ç­‰æ–¹æ³•æœ¬èº«ä¼šå…ˆæ‰§è¡Œï¼Œå®Œæˆå±æ€§çš„è®¾ç½®æ“ä½œï¼Œç„¶åç›¸å…³çš„Listeneræ‰ä¼šè¢«è§¦å‘ã€‚

## åˆ›å»ºä¸é…ç½®Listenerç±»

### åˆ›å»ºListenerç±»

**æ­¥éª¤**ï¼š

1. åˆ›å»ºä¸€ä¸ªæ™®é€šçš„Javaç±»
2. è®©è¿™ä¸ªç±»å®ç°ä½ æƒ³è¦ç›‘å¬çš„äº‹ä»¶å¯¹åº”çš„Listeneræ¥å£
3. é‡å†™è¯¥æ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶åœ¨è¿™äº›æ–¹æ³•ä¸­ç¼–å†™ä½ çš„ä¸šåŠ¡é€»è¾‘

ç¤ºä¾‹ï¼š

```java
package com.example.listeners; // å»ºè®®æ”¾åœ¨ä¸€ä¸ªä¸“é—¨çš„åŒ…ä¸­

import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;
import javax.servlet.annotation.WebListener; // å¦‚æœä½ æƒ³ä½¿ç”¨æ³¨è§£æ–¹å¼é…ç½®

// ä½¿ç”¨æ³¨è§£é…ç½®æ–¹å¼æ—¶éœ€è¦æ·»åŠ æ­¤æ³¨è§£
// @WebListener
public class MyApplicationListener implements ServletContextListener {

    /**
     * å½“Webåº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚
     * @param sce ServletContextEvent äº‹ä»¶å¯¹è±¡ï¼Œå¯ä»¥è·å–ServletContext
     */
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("ğŸ‰ğŸ‰ğŸ‰ Webåº”ç”¨ç¨‹åºå¯åŠ¨å•¦ï¼åœ¨ " + sce.getServletContext().getContextPath() + ".");
        // åœ¨è¿™é‡Œå¯ä»¥æ‰§è¡Œæ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–ã€åŠ è½½é…ç½®æ–‡ä»¶ç­‰å…¨å±€æ€§è®¾ç½®
        // ServletContext context = sce.getServletContext();
        // context.setAttribute("myGlobalData", "Some initialized data");
    }

    /**
     * å½“Webåº”ç”¨ç¨‹åºå…³é—­æ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚
     * @param sce ServletContextEvent äº‹ä»¶å¯¹è±¡
     */
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        System.out.println("ğŸ‘‹ğŸ‘‹ğŸ‘‹ Webåº”ç”¨ç¨‹åºå…³é—­äº†ã€‚æ¸…ç†èµ„æº...");
        // åœ¨è¿™é‡Œå¯ä»¥æ‰§è¡Œå…³é—­æ•°æ®åº“è¿æ¥ã€é‡Šæ”¾å†…å­˜ç­‰èµ„æºæ¸…ç†å·¥ä½œ
    }
}
```

### é…ç½®Listener

åˆ›å»ºå¥½Listenerç±»åï¼Œä½ éœ€è¦å‘Šè¯‰Servletå®¹å™¨ä½ çš„è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªListenerï¼Œå¹¶ä¸”å¸Œæœ›å®ƒåœ¨ç‰¹å®šçš„äº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨ã€‚

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `web.xml`æ–‡ä»¶é…ç½®(ä¼ ç»Ÿæ–¹å¼)

è¿™æ˜¯åœ¨Servlet3.0ä¹‹å‰ä»¥åŠéœ€è¦æœ€å¤§å…¼å®¹æ€§æ—¶ä½¿ç”¨çš„æ ‡å‡†æ–¹å¼ã€‚

1. åœ¨ `<web-app>`æ ‡ç­¾çš„å†…éƒ¨æ·»åŠ  `<listener>`æ ‡ç­¾
2. `<listener>`æ ‡ç­¾å†…éƒ¨ï¼Œä½¿ç”¨ `<listener-class>`æ ‡ç­¾æŒ‡å®šListenerç±»çš„å®Œå…¨é™å®šå(åŒ…æ‹¬åŒ…å)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                             http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <display-name>MyWebAppWithListeners</display-name>

    <listener>
        <listener-class>com.example.listeners.MyApplicationListener</listener-class>
    </listener>

    </web-app>
```

#### æ–¹æ³•äºŒï¼šä½¿ç”¨æ³¨è§£(Annotations)é…ç½®

ä»Servlet3.0å¼€å§‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ `@WebListener`æ³¨è§£æ¥ç®€åŒ–Listenerçš„é…ç½®ï¼Œæ— éœ€ä¿®æ”¹web.xmlã€‚è¿™æ˜¯ç›®å‰ä¸»æµæ›´ç®€æ´çš„æ–¹å¼ã€‚

```java
package com.example.listeners;

import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;
import javax.servlet.annotation.WebListener; // å¯¼å…¥WebListeneræ³¨è§£

@WebListener // æ ‡è®°è¿™ä¸ªç±»ä¸ºä¸€ä¸ªWeb Listener
public class MyApplicationListener implements ServletContextListener {

    @Override
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("ğŸ‰ğŸ‰ğŸ‰ Webåº”ç”¨ç¨‹åºå¯åŠ¨å•¦ï¼(é€šè¿‡æ³¨è§£é…ç½®) åœ¨ " + sce.getServletContext().getContextPath() + ".");
    }

    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        System.out.println("ğŸ‘‹ğŸ‘‹ğŸ‘‹ Webåº”ç”¨ç¨‹åºå…³é—­äº†ã€‚(é€šè¿‡æ³¨è§£é…ç½®) æ¸…ç†èµ„æº...");
    }
}
```

# ç®€å•å®æˆ˜

[xxy1103/javaWeb: ä¸€ä¸ªç®€å•çš„Servletã€Filterã€Listenerçš„æ¼”ç¤ºç¤ºä¾‹ã€‚ä¸€ä¸ªç®€å•çš„ç™»å½•éªŒè¯ç³»ç»Ÿï¼ŒåŒæ—¶ç»Ÿè®¡ç™»å½•åœ¨çº¿äººæ•°ã€‚](https://github.com/xxy1103/javaWeb)
