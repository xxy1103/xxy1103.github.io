---
title: Mybatis-Plus
date: 2025-09-08 22:20:43
categories: ç¬”è®°
tags: ['åç«¯', 'webå¼€å‘']
---
å¦‚æœè¯´ç©ºç™½è¡Œéš”å¼€äº†æ¦‚å¿µï¼Œé è¿‘çš„ä»£ç è¡Œåˆ™æš—ç¤ºäº†å®ƒä»¬ä¹‹é—´çš„ç´§å¯†å…³ç³»ã€‚

<!-- more -->

å®˜ç½‘ï¼š[MyBatis-Plus ğŸš€ ä¸ºç®€åŒ–å¼€å‘è€Œç”Ÿ](https://baomidou.com/)

# MyBatis-Plus

Mybatis-Plusé‡‡å–çº¦å®šå¤§äºé…ç½®çš„æ€æƒ³ï¼ŒæŒ‰ç…§çº¦å®šè¿›è¡Œå®šä¹‰ï¼Œå³å¯çœå»å¤§é‡ç¹ççš„ä»£ç ã€‚

**MyBatis-Plus** æ˜¯ MyBatis çš„å¢å¼ºå·¥å…·ï¼Œç®€åŒ–äº† CRUD æ“ä½œï¼Œå‡å°‘äº† XML é…ç½®ã€‚

## æ­¥éª¤

### 1. Mybatis-Pulsèµ·æ­¥ä¾èµ–

**MyBatis-Plus** æä¾›äº†  **Starter** ï¼Œå¯ä¸€æ¬¡æ€§å¼•å…¥ MyBatis ä¸ MyBatisPlus çš„æ ¸å¿ƒèƒ½åŠ›ã€‚

```xml
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.3.1</version>
</dependency>
```

### 2. å®šä¹‰Mapper

**MyBatis-Plus ç‰¹æ€§** ï¼š

* é€šè¿‡ç»§æ‰¿ `BaseMapper<T>`ï¼Œè‡ªåŠ¨è·å¾—å¤§é‡é€šç”¨ CRUD æ–¹æ³•ã€‚
* æ— éœ€æ‰‹å†™ XML æˆ–å®ç°ç±»å³å¯ç›´æ¥ä½¿ç”¨ã€‚

å®šä¹‰æ–¹å¼ï¼š

```java
public interface UserMapper extends BaseMapper<User> {
}
```

* **`UserMapper`** ï¼šè‡ªå®šä¹‰çš„ Mapper æ¥å£ã€‚
* **`BaseMapper<user>`** ï¼šæ³›å‹æŒ‡å®šå®ä½“ç±» `User`ï¼Œè‡ªåŠ¨ç»‘å®šè¯¥å®ä½“çš„ CRUD æ“ä½œã€‚
* é€šè¿‡ **`BaseMapper<t>`** æ¥å£ï¼Œè‡ªåŠ¨è·å¾—å•è¡¨çš„å¸¸ç”¨ CRUD æ–¹æ³•ï¼Œæ— éœ€æ‰‹å†™ SQLã€‚

**BaseMapperå¸¸ç”¨æ–¹æ³•**ï¼š

| åˆ†ç±»                     | æ–¹æ³•ç­¾å                                                              | è¯´æ˜                       |
| ------------------------ | --------------------------------------------------------------------- | -------------------------- |
| **Create**ï¼ˆæ–°å¢ï¼‰ | `int insert(T entity)`                                              | æ’å…¥ä¸€æ¡è®°å½•ï¼Œè¿”å›å½±å“è¡Œæ•° |
| **Update**ï¼ˆæ›´æ–°ï¼‰ | `int updateById(T entity)`                                          | æ ¹æ® ID æ›´æ–°è®°å½•           |
|                          | `int update(T entity, Wrapper<T> updateWrapper)`                    | æ ¹æ®æ¡ä»¶æ›´æ–°è®°å½•           |
| **Delete**ï¼ˆåˆ é™¤ï¼‰ | `int deleteById(Serializable id)`                                   | æ ¹æ® ID åˆ é™¤è®°å½•           |
|                          | `int deleteByMap(Map<String, Object> columnMap)`                    | æ ¹æ®å­—æ®µæ¡ä»¶ Map åˆ é™¤è®°å½•  |
|                          | `int delete(Wrapper<T> queryWrapper)`                               | æ ¹æ®æ¡ä»¶åˆ é™¤è®°å½•           |
|                          | `int deleteBatchIds(Collection<? extends Serializable> idList)`     | æ‰¹é‡åˆ é™¤ï¼ˆæ ¹æ® ID é›†åˆï¼‰   |
| **Read**ï¼ˆæŸ¥è¯¢ï¼‰   | `T selectById(Serializable id)`                                     | æ ¹æ® ID æŸ¥è¯¢å•æ¡è®°å½•       |
|                          | `List<T> selectBatchIds(Collection<? extends Serializable> idList)` | æ‰¹é‡æŸ¥è¯¢ï¼ˆæ ¹æ® ID é›†åˆï¼‰   |
|                          | `List<T> selectByMap(Map<String, Object> columnMap)`                | æ ¹æ®å­—æ®µæ¡ä»¶ Map æŸ¥è¯¢è®°å½•  |
|                          | `T selectOne(Wrapper<T> queryWrapper)`                              | æ ¹æ®æ¡ä»¶æŸ¥è¯¢å•æ¡è®°å½•       |
|                          | `Long selectCount(Wrapper<T> queryWrapper)`                         | æ ¹æ®æ¡ä»¶ç»Ÿè®¡è®°å½•æ•°         |
|                          | `List<T> selectList(Wrapper<T> queryWrapper)`                       | æ ¹æ®æ¡ä»¶æŸ¥è¯¢åˆ—è¡¨           |
|                          | `IPage<T> selectPage(IPage<T> page, Wrapper<T> queryWrapper)`       | åˆ†é¡µæŸ¥è¯¢                   |

## å¸¸è§æ³¨è§£

å®˜æ–¹æ–‡æ¡£ï¼š[æ³¨è§£é…ç½® | MyBatis-Plus](https://baomidou.com/reference/annotation/)

MybatisPlusé€šè¿‡æ‰«æå®ä½“ç±»ï¼Œå¹¶åŸºäºåå°„è·å–å®ä½“ç±»ä¿¡æ¯ä½œä¸ºæ•°æ®åº“è¡¨ä¿¡æ¯ã€‚

### MybatisPlusçº¦å®šé…ç½®

ä»¥æˆ‘ä»¬ä¸Šé¢çš„æ¥å£ä¸ºä¾‹ï¼š

```java
public interface UserMapper extends BaseMapper<User> {
}
```

MybatisPlusé€šè¿‡**åå°„**å¯ä»¥è·å–Userç±»çš„å®šä¹‰ï¼Œå¹¶é€šè¿‡çº¦å®šé…ç½®è¿›è¡Œ**è‡ªåŠ¨é…ç½®**ï¼š

å‡è®¾Userç±»å¦‚ä¸‹ï¼š

```java
@Data
public class User {
    private String username;
    private String password;
    private Integer age;
    private String sex;       // æˆ– gender
    private String phone;
    private String email;
    private Integer status;   // çŠ¶æ€å­—æ®µ
    private Double balance;   // ä½™é¢
    private Date createTime;
    private Date updateTime;
}
```

çº¦å®šé…ç½®ï¼š

* ç±»åé©¼å³°è½¬ä¸‹åˆ’çº¿ä½œä¸ºè¡¨åã€‚(è¡¨åä¸º `user`)
* åä¸ºidçš„å­—æ®µä½œä¸ºä¸»é”®ã€‚
* å˜é‡åé©¼å³°è½¬ä¸‹åˆ’çº¿ä½œä¸ºè¡¨çš„å­—æ®µåã€‚(`createTime` -> `create_time`)

### è‡ªå®šä¹‰é…ç½®

#### `@TableName`â€”â€”æŒ‡å®šè¡¨å

æ˜¾å¼æŒ‡å®šå®ä½“ç±»å¯¹åº”çš„æ•°æ®åº“è¡¨åï¼Œè¦†ç›– MyBatis-Plus çš„é»˜è®¤è¡¨åæ¨å¯¼è§„åˆ™ï¼ˆç±»å â†’ ä¸‹åˆ’çº¿ â†’ å°å†™ï¼‰ã€‚

```java
@TableName("t_user")
public class User { ... }
```

#### `@TableId`

æ ‡è¯†å®ä½“ç±»ä¸­çš„ä¸»é”®å­—æ®µï¼Œå¹¶å¯æŒ‡å®šä¸»é”®ç”Ÿæˆç­–ç•¥ã€‚

```java
@TableId(value = "id", type = IdType.AUTO)
private Long id;
```

å¸¸è§ä¸»é”®ç±»å‹(IdType æšä¸¾)ï¼š

| æšä¸¾å€¼        | è¯´æ˜                                 | é€‚ç”¨åœºæ™¯                           | æ³¨æ„äº‹é¡¹                                          |
| ------------- | ------------------------------------ | ---------------------------------- | ------------------------------------------------- |
| `AUTO`      | æ•°æ®åº“è‡ªå¢                           | MySQL ç­‰æ”¯æŒè‡ªå¢ä¸»é”®çš„æ•°æ®åº“       | æ•°æ®åº“å­—æ®µéœ€è®¾ç½®è‡ªå¢ï¼›æ’å…¥æ—¶ä¸»é”®å­—æ®µå¯ä¸º `null` |
| `NONE`      | æœªè®¾ç½®ä¸»é”®ç±»å‹ï¼ˆé»˜è®¤è·Ÿéšå…¨å±€é…ç½®ï¼‰   | ä¸æƒ³åœ¨å®ä½“ç±»ä¸Šå•ç‹¬æŒ‡å®šç­–ç•¥         | ä¾èµ–å…¨å±€ `global-config.db-config.id-type` é…ç½® |
| `INPUT`     | æ‰‹åŠ¨è¾“å…¥ä¸»é”®                         | ä¸»é”®ç”±ä¸šåŠ¡æ–¹ç”Ÿæˆï¼ˆå¦‚å¤–éƒ¨ç³»ç»Ÿä¼ å…¥ï¼‰ | æ’å…¥å‰å¿…é¡»æ‰‹åŠ¨è®¾ç½®ä¸»é”®å€¼ï¼Œå¦åˆ™æŠ¥é”™                |
| `ASSIGN_ID` | é›ªèŠ±ç®—æ³•ç”Ÿæˆå…¨å±€å”¯ä¸€ IDï¼ˆLong ç±»å‹ï¼‰ | åˆ†å¸ƒå¼ç³»ç»Ÿã€æ— æ•°æ®åº“è‡ªå¢éœ€æ±‚       | é»˜è®¤ç­–ç•¥ï¼ˆLong ç±»å‹ä¸»é”®ï¼‰ï¼›ä¸ä¾èµ–æ•°æ®åº“è‡ªå¢       |

**æ˜“é”™ç‚¹**

* æ•°æ®åº“ä¸»é”®éè‡ªå¢å´ä½¿ç”¨ `AUTO`ï¼Œä¼šå¯¼è‡´æ’å…¥å¤±è´¥ã€‚
* å¿˜è®°æ ‡æ³¨ä¸»é”®ï¼Œåˆ†é¡µã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œå¯èƒ½å¼‚å¸¸ã€‚

#### `@TableField`

**ä½œç”¨**

* æ˜¾å¼æŒ‡å®šå®ä½“å­—æ®µä¸æ•°æ®åº“åˆ—çš„æ˜ å°„å…³ç³»ã€‚
* æ§åˆ¶å­—æ®µæ˜¯å¦å‚ä¸ SQL æ“ä½œï¼ˆæ’å…¥ã€æ›´æ–°ã€æŸ¥è¯¢ï¼‰ã€‚

```java
@TableField(value = "create_time", fill = FieldFill.INSERT)
private Date createTime;
```

| å±æ€§å     | ç±»å‹        | è¯´æ˜                 | å¸¸è§å–å€¼ / ç¤ºä¾‹             | æ³¨æ„äº‹é¡¹                                         |
| ---------- | ----------- | -------------------- | --------------------------- | ------------------------------------------------ |
| `value`  | `String`  | æŒ‡å®šæ•°æ®åº“åˆ—å       | `"create_time"`           | å½“å­—æ®µåä¸åˆ—åä¸ä¸€è‡´æ—¶å¿…é¡»æŒ‡å®š                   |
| `exist`  | `boolean` | æ˜¯å¦ä¸ºæ•°æ®åº“è¡¨å­—æ®µ   | `true`ï¼ˆé»˜è®¤ï¼‰ã€`false` | `false` è¡¨ç¤ºè¯¥å­—æ®µä¸å‚ä¸æ˜ å°„ï¼ˆå¦‚ä¸šåŠ¡è®¡ç®—å­—æ®µï¼‰ |
| `select` | `boolean` | æŸ¥è¯¢æ—¶æ˜¯å¦è¿”å›è¯¥å­—æ®µ | `true`ï¼ˆé»˜è®¤ï¼‰ã€`false` | `false` å¯ç”¨äºæ•æ„Ÿå­—æ®µï¼ˆå¦‚å¯†ç ï¼‰åœ¨æŸ¥è¯¢æ—¶ä¸è¿”å› |
| `update` | `String`  | æ›´æ–°æ—¶çš„ SQL ç‰‡æ®µ    | `"NOW()"`                 | å¯ç”¨äºæ›´æ–°æ—¶è‡ªåŠ¨èµ‹å€¼ï¼Œå¦‚æ›´æ–°æ—¶é—´å­—æ®µ             |

> ç‰¹æ®Šæƒ…å†µï¼š
>
> * æˆå‘˜å˜é‡åä»¥iså¼€å¤´ï¼Œä¸”æ˜¯å¸ƒå°”å€¼ã€‚å¦‚isMarriedï¼Œé»˜è®¤æ•°æ®åº“å­—æ®µåä¸ºï¼šmarried
> * ä¸SQLè¯­è¨€å…³é”®å­—é‡åã€‚å¦‚order
>
>   ```java
>   @TableField(value = "`order`")
>   private String order;
>   ```

## å¸¸è§é…ç½®

å®˜æ–¹æ–‡æ¡£ï¼š[ä½¿ç”¨é…ç½® | MyBatis-Plus](https://baomidou.com/reference/)

### åŸºç¡€é…ç½®ï¼š(`mybatis-plus`æ ¹èŠ‚ç‚¹)

```yaml
mybatis-plus:
  type-aliases-package: com.itheima.mp.domain.po
  mapper-locations: "classpath:/mapper/**/*.xml"
```

| é…ç½®é¡¹                   | ä½œç”¨                                             | ç¬”è®°å…³è” / è¯´æ˜                                |
| ------------------------ | ------------------------------------------------ | ---------------------------------------------- |
| `type-aliases-package` | æŒ‡å®šå®ä½“ç±»æ‰€åœ¨åŒ…ï¼Œè‡ªåŠ¨æ³¨å†Œåˆ«åï¼ˆç±»åé¦–å­—æ¯å°å†™ï¼‰ | åœ¨ XML ä¸­å¯ç›´æ¥ç”¨åˆ«åä»£æ›¿å…¨ç±»åï¼Œä¾‹å¦‚ `user` |
| `mapper-locations`     | æŒ‡å®š Mapper XML æ–‡ä»¶ä½ç½®ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰           | å¯¹åº” `UserMapper.xml` ç­‰è‡ªå®šä¹‰ SQL æ–‡ä»¶è·¯å¾„  |

### Mybatisæ ¸å¿ƒé…ç½®(`configuration`èŠ‚ç‚¹)

```java
mybatis-plus:
    configuration:
        map-underscore-to-camel-case: true
        cache-enabled: false
```

| é…ç½®é¡¹                           | ä½œç”¨                          | ç¬”è®°å…³è” / è¯´æ˜                                                               |
| :------------------------------- | ----------------------------- | ----------------------------------------------------------------------------- |
| `map-underscore-to-camel-case` | å¼€å¯ä¸‹åˆ’çº¿ â†” é©¼å³°è‡ªåŠ¨æ˜ å°„    | ä¾‹å¦‚ `create_time` â†” `createTime`ï¼Œå¸ƒå°”å­—æ®µ `isMarried` â†” `married` |
| `cache-enabled`                | æ˜¯å¦å¼€å¯äºŒçº§ç¼“å­˜ï¼ˆé»˜è®¤ trueï¼‰ | åˆ†å¸ƒå¼ç¯å¢ƒå»ºè®®å…³é—­ï¼Œé¿å…ç¼“å­˜ä¸ä¸€è‡´                                            |

### å…¨å±€é…ç½®(`global-config.db-config`)

```yaml
mybatis-plus:
    global-config:
    db-config:
        id-type: assign_id
        update-strategy: not_null
```

| é…ç½®é¡¹              | ä½œç”¨                            | ç¬”è®°å…³è” / è¯´æ˜                                               |
| ------------------- | ------------------------------- | ------------------------------------------------------------- |
| `id-type`         | å…¨å±€ä¸»é”®ç­–ç•¥ï¼ˆ`IdType` æšä¸¾ï¼‰ | ä¾‹å¦‚ `assign_id` = é›ªèŠ±ç®—æ³• Long IDï¼Œå¯è¢« `@TableId` è¦†ç›– |
| `update-strategy` | å­—æ®µæ›´æ–°ç­–ç•¥                    | `not_null` è¡¨ç¤ºåªæ›´æ–°éç©ºå­—æ®µï¼Œé¿å… null è¦†ç›–æ•°æ®åº“å€¼       |

ğŸ’¡ **çŸ¥è¯†é—­ç¯**

1. **å®ä½“ç±» â†” è¡¨æ˜ å°„** ï¼šç”± `map-underscore-to-camel-case` + æ³¨è§£æ§åˆ¶
2. **ä¸»é”®ç­–ç•¥** ï¼šå…¨å±€ `id-type` + `@TableId`
3. **æ›´æ–°è¡Œä¸º** ï¼šå…¨å±€ `update-strategy` + `@TableField`
4. **SQL æ–‡ä»¶åŠ è½½** ï¼š`mapper-locations` å†³å®š XML èƒ½å¦è¢«æ‰«æåˆ°

# æ ¸å¿ƒåŠŸèƒ½

## æ¡ä»¶æ„é€ å™¨-Wrapper

Wrapperæ˜¯Mybatis-Plusæä¾›çš„åŠ¨æ€SQLæ¡ä»¶æ„é€ å™¨ï¼Œç”¨é“¾å¼è°ƒç”¨çš„æ–¹æ³•æ„å»ºå¤æ‚WHEREæ¡ä»¶(ä»¥åŠSETæ›´æ–°å­—æ®µ)ï¼Œé¿å…æ‰‹å†™SQLï¼Œæé«˜å¯ç»´æŠ¤æ€§ï¼Œå¹¶å‡å°‘SQLæ³¨å…¥çš„é£é™©ã€‚

ä¸»è¦ç±»å‹å¯¹æ¯”ï¼š

![1757488048014](image/Mybatis-Plus_20250908_222043/1757488048014.webp)

| æ„é€ å™¨                     | ç”¨é€”     | ç‰¹ç‚¹                                     | é€‚ç”¨åœºæ™¯                       |
| -------------------------- | -------- | ---------------------------------------- | ------------------------------ |
| `QueryWrapper<T>`        | æŸ¥è¯¢æ¡ä»¶ | å­—æ®µåç”¨å­—ç¬¦ä¸²                           | ç®€å•åœºæ™¯ï¼Œå­—æ®µåå›ºå®š           |
| `LambdaQueryWrapper<T>`  | æŸ¥è¯¢æ¡ä»¶ | å­—æ®µåç”¨æ–¹æ³•å¼•ç”¨ï¼ˆå¦‚ `User::getName`ï¼‰ | æ¨èé¦–é€‰ï¼Œé¿å…ç¡¬ç¼–ç ï¼Œé‡æ„å®‰å…¨ |
| `UpdateWrapper<T>`       | æ›´æ–°æ¡ä»¶ | æ”¯æŒ `set` + æ¡ä»¶                      | æ— éœ€å®ä½“å¯¹è±¡å‚ä¸æ›´æ–°           |
| `LambdaUpdateWrapper<T>` | æ›´æ–°æ¡ä»¶ | æ–¹æ³•å¼•ç”¨ + æ›´æ–°                          | æ¨èé¦–é€‰ï¼Œå®‰å…¨æ›´æ–°å­—æ®µ         |

> `QueryWrapper`ï¼šåœ¨ `AbstractWrapper`çˆ¶ç±»ä¹‹ä¸Šæ‹“å±•äº†æŸ¥è¯¢selectçš„æ–¹æ³•ã€‚
>
> `UpdateWrapper`ï¼šåœ¨çˆ¶ç±»ä¹‹ä¸Šæ‹“å±•äº†æ›´æ–°setçš„æ–¹æ³•ã€‚

å¸¸ç”¨æ¡ä»¶æ–¹æ³•ï¼š

| æ–¹æ³•                                    | è¯´æ˜            | ç¤ºä¾‹                                             |
| --------------------------------------- | --------------- | ------------------------------------------------ |
| `eq`                                  | ç­‰äº            | `.eq("status", 1)` â†’ `status = 1`           |
| `ne`                                  | ä¸ç­‰äº          | `.ne(User::getName, "å¼ ä¸‰")`                   |
| `gt` / `ge`                         | å¤§äº / å¤§äºç­‰äº | `.gt("age", 18)`                               |
| `lt` / `le`                         | å°äº / å°äºç­‰äº | `.le(User::getAge, 30)`                        |
| `between`                             | åŒºé—´            | `.between("age", 20, 30)`                      |
| `like` / `likeLeft` / `likeRight` | æ¨¡ç³ŠåŒ¹é…        | `.like(User::getName, "å¼ ")`                   |
| `isNull` / `isNotNull`              | ç©ºå€¼åˆ¤æ–­        | `.isNotNull("email")`                          |
| `in` / `notIn`                      | é›†åˆåŒ¹é…        | `.in("id", Arrays.asList(1,2,3))`              |
| `orderByAsc` / `orderByDesc`        | æ’åº            | `.orderByDesc("create_time")`                  |
| `and` / `or`                        | é€»è¾‘ç»„åˆ        | `.and(w -> w.eq("status", 1).lt("age", 30))`   |
| `allEq`                               | æ‰¹é‡ç­‰äº        | `.allEq(map, true)`ï¼ˆ`null` è½¬ `IS NULL`ï¼‰ |

ç¤ºä¾‹1ï¼šQueryWrapper

![1757488616235](image/Mybatis-Plus_20250908_222043/1757488616235.webp)

MybatisPlusç¤ºä¾‹ï¼š

```java
void testQueryWrapper() {
    // æŸ¥è¯¢è¯­å¥æ¡ä»¶
    QueryWrapper<User> wrapper = new QueryWrapper<User>()
        .select("id", "username", "info", "balance")
        .like("username", "o")
        .ge("balance", 1000);

    // æŸ¥è¯¢
    List<User> users = userMapper.selectList(wrapper);
    users.forEach(System.out::println);
}
```

ç¤ºä¾‹2ï¼šUpdateWrapper

![1757489036051](image/Mybatis-Plus_20250908_222043/1757489036051.webp)

MybatisPlusç¤ºä¾‹ï¼š

```java
@Test
void testUpdateWrapper() {
    List`<Long>` ids = List.of(1L, 2L, 4L);

    UpdateWrapper`<User>` wrapper = new UpdateWrapper`<User>`()
        .setSql("balance = balance - 200")
        .in("id", ids);

    userMapper.update(null, wrapper);
}
```

ç¤ºä¾‹3ï¼šLambdaUpdateWrapper

> LambdaWrapperè¡¨è¾¾å¼ä¸­å±æ€§çš„åå­—ä¸é‡‡ç”¨ç¡¬ç¼–ç ï¼Œè€Œä½¿ç”¨å¯¹è±¡æ–¹æ³•æ¥è·å–å­—æ®µåã€‚

```java
void testLambdaQueryWrapper() {
    LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<>();
    wrapper.select(User::getId, User::getUsername, User::getBalance)
           .eq(User::getUsername, "o")
           .ge(User::getBalance, 1000);
    List<User> users = userMapper.selectList(wrapper);
    users.forEach(System.out::println);
}
```

## è‡ªå®šä¹‰SQL

ä¸Šé¢çš„ç¤ºä¾‹2ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å°†SQLè¯­å¥ç¡¬ç¼–ç åœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼š`balance = balance - 200`ï¼Œåœ¨ä¼ä¸šå¼€å‘è§„èŒƒä¸­ï¼Œè¿™æ ·ç¡¬ç¼–ç åœ¨ä¸šåŠ¡ä»£ç ä¸­çš„è¯­å¥é€šå¸¸æ˜¯ä¸ç¬¦åˆè§„èŒƒçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰SQLæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

è‡ªå®šä¹‰SQLå…è®¸æˆ‘ä»¬ä½¿ç”¨åŸºæœ¬çš„Mybatisæ¥ä¹¦å†™åŸºæœ¬çš„sqlè¯­å¥ï¼Œå´ä½¿ç”¨Mybatis-plusæ¥çš„Wrapperæ¥é…ç½®whereæ¡ä»¶ã€‚ç®€åŒ–äº†mybatisé…ç½®æ–‡ä»¶ä¸­whereè¯­å¥çš„ä¹¦å†™ï¼Œä¸”å°†å…¶ç§»åŠ¨è‡³ä¸šåŠ¡é€»è¾‘ä¸­ã€‚

### æ­¥éª¤

1. æ„å»ºWHEREæ¡ä»¶

* ä½¿ç”¨ `LambdaQueryWrapper` å¯ä»¥é€šè¿‡ **æ–¹æ³•å¼•ç”¨** å®‰å…¨åœ°æŒ‡å®šå­—æ®µï¼Œé¿å…ç¡¬ç¼–ç å­—ç¬¦ä¸²ã€‚
* ç¤ºä¾‹ï¼š

  ```java
  List<Long> ids = List.of(1L, 2L, 4L);
  LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<User>()
      .in(User::getId, ids);
  userMapper.updateBalanceByIds(wrapper, amount);
  ```

2. Mapperæ¥å£å‚æ•°ä¼ é€’

* åœ¨ Mapper æ–¹æ³•ä¸­ä½¿ç”¨ `@Param` æ³¨è§£ä¼ é€’å‚æ•°ã€‚
* ç¤ºä¾‹ï¼š
  ```java
  void updateBalanceByIds(@Param("ew") LambdaQueryWrapper<User> wrapper,
                          @Param("amount") BigDecimal amount);
  ```

> * `ew` æ˜¯ MyBatisPlus çº¦å®šçš„å‚æ•°åï¼Œç”¨äºåœ¨ XML ä¸­å¼•ç”¨ `LambdaQueryWrapper`ã€‚
> * å…¶ä»–å‚æ•°ï¼ˆå¦‚ `amount`ï¼‰å¯æŒ‰éœ€å‘½åã€‚

3. XMLä¸­ä½¿ç”¨ `ew.customSqlSegment`

* åœ¨ XML ä¸­é€šè¿‡ `${ew.customSqlSegment}` å¼•å…¥åŠ¨æ€ SQL æ¡ä»¶ã€‚
* ç¤ºä¾‹ï¼š

  ```xml
  <update id="updateBalanceByIds">
    UPDATE user
    SET balance = balance + #{amount}
    ${ew.customSqlSegment}
  </update>
  ```

## Serviceæ¥å£

MyBatis-Plus æä¾›äº†ä¸€ä¸ªé€šç”¨çš„ Service å±‚æ¥å£ `IService<t></t>`ï¼Œä»¥åŠé»˜è®¤å®ç°ç±» `ServiceImpl<m, t=""></m,>`ï¼Œç”¨äºç®€åŒ–ä¸šåŠ¡å±‚çš„ CRUD æ“ä½œã€‚

![1757578211301](image/Mybatis-Plus_20250908_222043/1757578211301.webp)

### åŸºæœ¬ä½¿ç”¨

#### ä½¿ç”¨æ­¥éª¤

1. è‡ªå®šä¹‰æ¥å£ç»§æ‰¿ `IService<T>`

   ```java
   public interface IUserService extends IService<User> {
       // å¯ä»¥æ·»åŠ è‡ªå®šä¹‰ä¸šåŠ¡æ–¹æ³•
   }
   ```
2. å®ç°ç±»ç»§æ‰¿ServiceImpl<M,T>

   ```java
   @Service
   public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements IUserService {
       // å¯ä»¥é‡å†™æˆ–æ‰©å±•æ–¹æ³•
   }
   ```

ç„¶åæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ServiceImplä¸­ç»§æ‰¿çš„é»˜è®¤å®ç°æ–¹æ³•ã€‚

#### å¸¸ç”¨æ–¹æ³•

| åˆ†ç±»               | æ–¹æ³•                                             | è¯´æ˜         |
| ------------------ | ------------------------------------------------ | ------------ |
| **æ–°å¢**     | `save(T entity)`                               | æ’å…¥å•æ¡è®°å½• |
|                    | `saveBatch(Collection<T> list)`                | æ‰¹é‡æ’å…¥     |
| **æ›´æ–°**     | `updateById(T entity)`                         | æ ¹æ® ID æ›´æ–° |
|                    | `update(T entity, Wrapper<T> updateWrapper)`   | æ¡ä»¶æ›´æ–°     |
| **åˆ é™¤**     | `removeById(Serializable id)`                  | æ ¹æ® ID åˆ é™¤ |
|                    | `remove(Wrapper<T> queryWrapper)`              | æ¡ä»¶åˆ é™¤     |
| **æŸ¥è¯¢**     | `getById(Serializable id)`                     | æ ¹æ® ID æŸ¥è¯¢ |
|                    | `list()`                                       | æŸ¥è¯¢å…¨éƒ¨     |
|                    | `list(Wrapper<T> queryWrapper)`                | æ¡ä»¶æŸ¥è¯¢     |
|                    | `page(IPage<T> page, Wrapper<T> queryWrapper)` | åˆ†é¡µæŸ¥è¯¢     |
| **ç»Ÿè®¡**     | `count()`                                      | ç»Ÿè®¡æ€»æ•°     |
|                    | `count(Wrapper<T> queryWrapper)`               | æ¡ä»¶ç»Ÿè®¡     |
| **é“¾å¼è°ƒç”¨** | `lambdaQuery()`                                | é“¾å¼æ¡ä»¶æŸ¥è¯¢ |
|                    | `lambdaUpdate()`                               | é“¾å¼æ¡ä»¶æ›´æ–° |

### IServiceçš„LambdaæŸ¥è¯¢

#### LambdaQuery

`lambdaQuery` æ˜¯ MyBatis-Plus æä¾›çš„ **åŸºäº Lambda è¡¨è¾¾å¼çš„æ¡ä»¶æ„é€ å™¨** ï¼Œå®ƒçš„æ ¸å¿ƒä¼˜åŠ¿æ˜¯ï¼š

* **ç±»å‹å®‰å…¨** ï¼šé€šè¿‡æ–¹æ³•å¼•ç”¨ï¼ˆå¦‚ `User::getName`ï¼‰é¿å…äº†ç¡¬ç¼–ç å­—æ®µåï¼Œå­—æ®µæ”¹åæ—¶ç¼–è¯‘æœŸå³å¯å‘ç°é—®é¢˜ã€‚
* **é“¾å¼è°ƒç”¨** ï¼šæ”¯æŒæµå¼ APIï¼Œæ¡ä»¶æ‹¼æ¥æ›´ç›´è§‚ã€‚
* **å¯è¯»æ€§å¼º** ï¼šæ¡ä»¶è¯­ä¹‰æ¸…æ™°ï¼Œå‡å°‘ SQL æ‹¼å†™é”™è¯¯ã€‚

`lambdaQuery`åœ¨ `lambdaQueryWrapper`çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›å¸¸ç”¨çš„ç»ˆç«¯æ“ä½œï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ„é€ çš„æ¡ä»¶è¿›è¡ŒæŸ¥è¯¢ã€‚

##### å¸¸è§ç»ˆç«¯æ“ä½œ

| æ–¹æ³•                                   | è¿”å›ç±»å‹                      | ä½œç”¨                     | å¸¸è§ç”¨æ³•ç¤ºä¾‹                    | å¤‡æ³¨                                    |
| -------------------------------------- | ----------------------------- | ------------------------ | ------------------------------- | --------------------------------------- |
| `list()`                             | `List<T>`                   | æŸ¥è¯¢å¤šæ¡è®°å½•             | `.list()`                     | æœ€å¸¸ç”¨ï¼Œè¿”å›é›†åˆï¼Œè‹¥æ— ç»“æœè¿”å›ç©ºé›†åˆ    |
| `one()`                              | `T`                         | æŸ¥è¯¢å•æ¡è®°å½•             | `.one()`                      | è‹¥ç»“æœå¤šäº 1 æ¡ä¼šæŠ›å¼‚å¸¸ï¼Œé€‚åˆå”¯ä¸€æ€§æŸ¥è¯¢ |
| `oneOpt()`                           | `Optional<T>`               | æŸ¥è¯¢å•æ¡è®°å½•ï¼ˆå¯é€‰ï¼‰     | `.oneOpt()`                   | é¿å…ç©ºæŒ‡é’ˆï¼ŒJava 8+ æ¨è                |
| `getOne(boolean throwEx)`            | `T`                         | æŸ¥è¯¢å•æ¡è®°å½•ï¼ˆå¯é€‰é™åˆ¶ï¼‰ | `.getOne(false)`              | `throwEx=false` æ—¶å¤šæ¡è¿”å›é¦–æ¡        |
| `count()`                            | `long`                      | ç»Ÿè®¡æ•°é‡                 | `.count()`                    | å¸¸ç”¨äºåˆ†é¡µå‰çš„æ€»æ•°ç»Ÿè®¡                  |
| `exists()`                           | `boolean`                   | åˆ¤æ–­æ˜¯å¦å­˜åœ¨è®°å½•         | `.exists()`                   | æ¯” `count() > 0` æ›´é«˜æ•ˆ               |
| `listObjs()`                         | `List<Object>`              | æŸ¥è¯¢å•åˆ—æ•°æ®             | `.listObjs()`                 | åªå–ç¬¬ä¸€åˆ—çš„å€¼ï¼Œå‡å°‘å†…å­˜å ç”¨            |
| `listObjs(Function<T,?> mapper)`     | `List<R>`                   | æŸ¥è¯¢å•åˆ—å¹¶æ˜ å°„           | `.listObjs(User::getName)`    | ç›´æ¥è¿”å›æŒ‡å®šå­—æ®µé›†åˆ                    |
| `listMaps()`                         | `List<Map<String,Object>>`  | æŸ¥è¯¢å¤šæ¡è®°å½•ï¼ˆMapï¼‰      | `.listMaps()`                 | é€‚åˆåŠ¨æ€åˆ—æˆ–ä¸æƒ³æ˜ å°„å®ä½“ç±»æ—¶            |
| `page(Page<T>)`                      | `IPage<T>`                  | åˆ†é¡µæŸ¥è¯¢                 | `.page(new Page<>(1,10))`     | ç»“åˆåˆ†é¡µæ’ä»¶ä½¿ç”¨                        |
| `pageMaps(Page<Map<String,Object>>)` | `IPage<Map<String,Object>>` | åˆ†é¡µæŸ¥è¯¢ï¼ˆMapï¼‰          | `.pageMaps(new Page<>(1,10))` | è¿”å› Map å½¢å¼åˆ†é¡µç»“æœ                   |

---

å¯¹æ¯”ç¤ºä¾‹ï¼š

mybatisï¼š

```xml
<select id="queryUsers" resultType="com.example.User">
    SELECT
        id,
        username,
        status,
        balance
    FROM
        user
    <where>
        <if test="name != null">
            AND username LIKE CONCAT('%', #{name}, '%')
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
        <if test="minBalance != null">
            AND balance >= #{minBalance}
        </if>
        <if test="maxBalance != null">
            AND balance <= #{maxBalance}
        </if>
    </where>
</select>
```

mybatis.plusï¼š

```java
@Override
public List<User> queryUsers(String name, Integer status, Integer minBalance, Integer maxBalance) {
    return lambdaQuery()
        .like(name != null, User::getUsername, name)  //ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç”Ÿæ•ˆæ¡ä»¶
        .eq(status != null, User::getStatus, status)
        .ge(minBalance != null, User::getBalance, minBalance)
        .le(maxBalance != null, User::getBalance, maxBalance)
        .list();
}
```

> åŠ¨æ€æ¡ä»¶æ‹¼æ¥ï¼šåˆ©ç”¨ `condition`å‚æ•°é¿å…æ— æ•ˆæ¡ä»¶ã€‚

##### andå’Œorçš„ä½¿ç”¨æ–¹å¼

åœ¨MyBatis-Plusçš„ `LambdQuaryWrapper`æˆ– `lambdaQuery()`ä¸­ï¼š

* `.and(Consumer<Wrapper>)`ï¼šç”¨äºæ„é€ æ‹¬å·åŒ…è£¹çš„ANDæ¡ä»¶ç»„ã€‚
* `.or(Consumer<Wrapper>)`ï¼šç”¨äºæ„é€ æ‹¬å·åŒ…è£¹çš„ORæ¡ä»¶ç»„ã€‚
* `.or()`ï¼šç”¨äºç›´æ¥æ’å…¥ä¸€ä¸ªORè¿æ¥ç¬¦å·ã€‚

ç¤ºä¾‹ï¼š

```java
lambdaQuery()
    .and(q -> q.eq(User::getStatus, 1).gt(User::getBalance, 1000))
    .or(q -> q.eq(User::getStatus, 0).lt(User::getBalance, 500))
    .list();

```

SQL:

```sql
WHERE (status = 1 AND balance > 1000) OR (status = 0 AND balance < 500)
```

æ€»ç»“ï¼š

```
lambdaQuery æ¡ä»¶ç»„åˆ
 â”œâ”€â”€ é»˜è®¤ ANDï¼šè¿ç»­è°ƒç”¨æ¡ä»¶æ–¹æ³•
 â”œâ”€â”€ or()ï¼šæ’å…¥ ORï¼ˆæ— æ‹¬å·ï¼‰
 â”œâ”€â”€ or(q -> {...})ï¼šOR æ¡ä»¶ç»„ï¼ˆæ¨èï¼‰
 â”œâ”€â”€ and(q -> {...})ï¼šAND æ¡ä»¶ç»„ï¼ˆæ¨èï¼‰
 â””â”€â”€ åµŒå¥—ç»„åˆï¼šå®ç°å¤æ‚é€»è¾‘è¡¨è¾¾å¼
```

#### LambdaUpdate

lambdaUpdateæ˜¯MyBatis-Plusæä¾›çš„åŸºäºLambdaè¡¨è¾¾å¼çš„æ›´æ–°æ„é€ å™¨ã€‚å®ƒçš„ä½œç”¨ç±»ä¼¼äº `lambdaQuery`ï¼Œä½†æ˜¯ç”¨äºUPDAREæ“ä½œã€‚

é“¾å¼è°ƒç”¨ï¼š

```java
boolean updated = userService.lambdaUpdate()
			     .set(User::getUsername, "å¼ ä¸‰")   //æ›´æ–°å­—æ®µ
			     .set(User::getBalance, 2000)	//æ”¯æŒåŒæ—¶æ›´æ–°å¤šä¸ªå­—æ®µ
			     .eq(User::getId, 1001)		//æ›´æ–°æ¡ä»¶
			     .update();				//æ‰§è¡Œæ›´æ–°
```

ç”ŸæˆSQLï¼š

```java
UPDATE user SET username = 'å¼ ä¸‰', balance = 2000 WHERE id = 1001
```

åŠ¨æ€æ¡ä»¶æ›´æ–°ï¼š

```java
boolean update = userService.lambdaUpdate()
			.set(name != null, User::getUsername, name)
			.set(minBalance != null, User:getBalance, minBalance)
			.eq(User.getStatus, 1)
			.update();
```

> åªæœ‰å½“ `name`æˆ– `minBalance`éç©ºæ—¶ï¼Œæ‰ä¼šæ‹¼æ¥å¯¹åº”çš„SETè¯­å¥ã€‚

åˆ é™¤æ“ä½œï¼š

`lambdaUpdate`ä¹Ÿå¯ä»¥æ¥æ„é€ åˆ é™¤æ¡ä»¶ï¼š

```java
boolean removed = userService.lambdaUpdate()
    .eq(User::getStatus, 0)
    .remove();
```

ç”Ÿæˆsqlï¼š

```java
DELETE FROM user WHERE status = 0
```

### æ‰¹é‡æ–°å¢

#### å¾ªç¯å•ä¸ªæ’å…¥

```java
@Test
void testSaveOneByOne() {
    long b = System.currentTimeMillis();
    for (int i = 1; i <= 100000; i++) {
        userService.save(buildUser(i));
    }
    long e = System.currentTimeMillis();
    System.out.println("è€—æ—¶: " + (e - b));
}
```

è¿™ç§æ–¹å¼æ’å…¥æ•°æ®éå¸¸æ…¢ï¼ŒåŸå› å¦‚ä¸‹ï¼š

* æ¯æ¬¡è°ƒç”¨éƒ½æ˜¯ä¸€æ¬¡ç‹¬ç«‹çš„æ•°æ®åº“äº‹åŠ¡/è¿æ¥
* ç½‘ç»œå¾€è¿”æ¬¡æ•°è¿‡å¤š
  * 10ä¸‡æ¬¡ç½‘ç»œè¯·æ±‚
* ORMæ¡†æ¶çš„é¢å¤–å¼€é”€

æµ‹è¯•è€—æ—¶ï¼š20ä¸‡ms

#### æ‰¹å¤„ç†

```java
@Test
public void testSaveBatch() {
    // æ¨¡æ‹Ÿç”Ÿæˆ100000ä¸ªç”¨æˆ·ï¼Œæ’å…¥100000æ¡è®°å½•åˆ°æ•°æ®åº“
    List<User> list = new ArrayList<>(100000);
    long b = System.currentTimeMillis();
    for (int i = 1; i < 100000; i++) {
        // æ„é€ ç”¨æˆ·
        User user = buildUser(i);
        list.add(user);
        // æ¯1000æ¡è®°å½•æ’å…¥ä¸€æ¬¡
        if (i % 1000 == 0) {
            userService.saveBatch(list);
            list.clear();
        }
    }
    long e = System.currentTimeMillis();
    System.out.println("è€—æ—¶ï¼š" + (e - b));
}

```

æµ‹è¯•è€—æ—¶ï¼š2ä¸‡ms

ä¸ºä»€ä¹ˆå¿«ï¼š

* å‡å°‘æ•°æ®åº“äº¤äº’æ¬¡æ•°ã€‚
  * 100æ¬¡ç½‘ç»œè¯·æ±‚
* é™ä½äº‹åŠ¡çš„å¼€é”€
  * 100æ¬¡COMMIT
* SQLä¼˜åŒ–å™¨æ›´é«˜æ•ˆ
  * åˆå¹¶æˆä¸€æ¡ `INSERT...VALUES(...),(...),...`æ•°æ®åº“åªä¼šè§£æä¸€æ¬¡SQLï¼Œæ‰§è¡Œè®¡åˆ’ä¹Ÿåªç”Ÿæˆä¸€æ¬¡ã€‚
* è¾ƒå°‘QRMé¢å¤–çš„å¼€é”€

![1758108670644](image/Mybatis-Plus_20250908_222043/1758108670644.webp)

> è¦è®©Mybatis=Pluså¼€å¯SQLä¼˜åŒ–å™¨ï¼Œéœ€è¦å¼€å¯MySqlçš„ `rewriteBatchedStatements`å‚æ•°ã€‚
>
> å¼€å¯æ–¹æ³•ï¼š`application.yml`
>
> åœ¨jdbcè¿æ¥åæ‹¼æ¥å‚æ•°ï¼š
>
> ```
> jdbc:mysql://localhost:3306/tlias&rewriteBatchedStatements=true
> ```
